groups:
  # ========================================================================
  # –ê–õ–ï–†–¢–´ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò (Security Alerts)
  # ========================================================================
  - name: security_alerts
    rules:
      # –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –Ω–µ—É–¥–∞—á–Ω—ã–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
      - alert: MultipleFailedLogins
        expr: increase(logstash_events_total{tags=~".*auth_event.*"}[5m]) > 10
        for: 2m
        labels:
          severity: warning
          category: security
          service: authentication
        annotations:
          summary: "–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –Ω–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –≤—Ö–æ–¥–∞"
          description: "–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ {{ $value }} –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –º–∏–Ω—É—Ç"
          runbook_url: "https://docs.company.com/runbooks/security/failed-logins"

      # SQL –∏–Ω—ä–µ–∫—Ü–∏–∏
      - alert: SQLInjectionAttempt
        expr: increase(logstash_events_total{tags=~".*sql_injection_attempt.*"}[10m]) > 0
        for: 0m
        labels:
          severity: critical
          category: security
          attack_type: sql_injection
        annotations:
          summary: "üö® –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø–æ–ø—ã—Ç–∫–∞ SQL-–∏–Ω—ä–µ–∫—Ü–∏–∏!"
          description: "–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞ {{ $value }} –ø–æ–ø—ã—Ç–∫–∞ SQL-–∏–Ω—ä–µ–∫—Ü–∏–∏. –¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ."
          runbook_url: "https://docs.company.com/runbooks/security/sql-injection"

      # XSS –∞—Ç–∞–∫–∏
      - alert: XSSAttempt
        expr: increase(logstash_events_total{tags=~".*xss_attempt.*"}[10m]) > 0
        for: 0m
        labels:
          severity: critical
          category: security
          attack_type: xss
        annotations:
          summary: "üö® –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø–æ–ø—ã—Ç–∫–∞ XSS –∞—Ç–∞–∫–∏!"
          description: "–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞ {{ $value }} –ø–æ–ø—ã—Ç–∫–∞ XSS –∞—Ç–∞–∫–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏."
          runbook_url: "https://docs.company.com/runbooks/security/xss-attack"

      # –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ HTTP –æ—à–∏–±–∫–∞–º
      - alert: HighHTTPErrorRate
        expr: (rate(nginx_http_requests_total{status=~"4..|5.."}[5m]) / rate(nginx_http_requests_total[5m])) * 100 > 20
        for: 3m
        labels:
          severity: warning
          category: security
          service: nginx
        annotations:
          summary: "–í—ã—Å–æ–∫–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç HTTP –æ—à–∏–±–æ–∫"
          description: "{{ $value | humanizePercentage }} HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞–≤–µ—Ä—à–∞—é—Ç—Å—è —Å –æ—à–∏–±–∫–∞–º–∏ (4xx/5xx) –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –º–∏–Ω—É—Ç"
          runbook_url: "https://docs.company.com/runbooks/security/http-errors"

      # –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã
      - alert: SuspiciousGeographicActivity
        expr: increase(logstash_events_total{geoip_country_name!~"Russia|Belarus|Kazakhstan"}[1h]) > 100
        for: 5m
        labels:
          severity: warning
          category: security
          type: geographic
        annotations:
          summary: "–ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å"
          description: "{{ $value }} –∑–∞–ø—Ä–æ—Å–æ–≤ –∏–∑ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã—Ö –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö —Ä–µ–≥–∏–æ–Ω–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å"

  # ========================================================================
  # –ê–õ–ï–†–¢–´ –ó–î–û–†–û–í–¨–Ø –°–ï–†–í–ò–°–û–í (Service Health Alerts)
  # ========================================================================
  - name: service_health
    rules:
      # –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
      - alert: ContainerDown
        expr: up == 0
        for: 1m
        labels:
          severity: critical
          category: infrastructure
          component: container
        annotations:
          summary: "üî¥ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä {{ $labels.job }} –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
          description: "–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä {{ $labels.job }} –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ health checks –±–æ–ª–µ–µ 1 –º–∏–Ω—É—Ç—ã"
          runbook_url: "https://docs.company.com/runbooks/infrastructure/container-down"

      # –í—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU
      - alert: HighCPUUsage
        expr: (100 - (avg by (instance) (irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100)) > 80
        for: 5m
        labels:
          severity: warning
          category: performance
          resource: cpu
        annotations:
          summary: "–í—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU"
          description: "CPU –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ {{ $value | humanizePercentage }} –Ω–∞ {{ $labels.instance }}"

      # –í—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
      - alert: HighMemoryUsage
        expr: (1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100 > 85
        for: 3m
        labels:
          severity: warning
          category: performance
          resource: memory
        annotations:
          summary: "–í—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏"
          description: "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ {{ $value | humanizePercentage }} –Ω–∞ {{ $labels.instance }}"

      # –í—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞
      - alert: HighDiskUsage
        expr: (1 - (node_filesystem_avail_bytes{fstype!="tmpfs"} / node_filesystem_size_bytes{fstype!="tmpfs"})) * 100 > 85
        for: 2m
        labels:
          severity: critical
          category: infrastructure
          resource: disk
        annotations:
          summary: "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∏—Å–∫–∞"
          description: "–î–∏—Å–∫ {{ $labels.mountpoint }} –∑–∞–ø–æ–ª–Ω–µ–Ω –Ω–∞ {{ $value | humanizePercentage }}"

  # ========================================================================
  # –ê–õ–ï–†–¢–´ –ü–†–ò–õ–û–ñ–ï–ù–ò–ô (Application Alerts)
  # ========================================================================
  - name: application_health
    rules:
      # PostgreSQL –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
      - alert: PostgreSQLDown
        expr: pg_up == 0
        for: 1m
        labels:
          severity: critical
          category: database
          service: postgresql
        annotations:
          summary: "üî¥ PostgreSQL –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
          description: "–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –±–æ–ª–µ–µ 1 –º–∏–Ω—É—Ç—ã"
          runbook_url: "https://docs.company.com/runbooks/database/postgresql-down"

      # Elasticsearch –∫–ª–∞—Å—Ç–µ—Ä –Ω–µ –∑–¥–æ—Ä–æ–≤
      - alert: ElasticsearchClusterUnhealthy
        expr: elasticsearch_cluster_health_status{color!="green"} == 1
        for: 2m
        labels:
          severity: warning
          category: search
          service: elasticsearch
        annotations:
          summary: "Elasticsearch –∫–ª–∞—Å—Ç–µ—Ä –Ω–µ –≤ –∑–µ–ª–µ–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏"
          description: "–°—Ç–∞—Ç—É—Å –∫–ª–∞—Å—Ç–µ—Ä–∞ Elasticsearch: {{ $labels.color }}"

      # Kafka –æ—Ç—Å—Ç–∞–µ—Ç –ø–æ —Å–æ–æ–±—â–µ–Ω–∏—è–º
      - alert: KafkaConsumerLag
        expr: kafka_consumer_lag_sum > 1000
        for: 3m
        labels:
          severity: warning
          category: messaging
          service: kafka
        annotations:
          summary: "–ë–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ Kafka consumer"
          description: "Consumer lag —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç {{ $value }} —Å–æ–æ–±—â–µ–Ω–∏–π"

      # –í—ã—Å–æ–∫–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç –æ—à–∏–±–æ–∫ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
      - alert: HighApplicationErrorRate
        expr: (rate(http_requests_total{status=~"5.."}[5m]) / rate(http_requests_total[5m])) * 100 > 5
        for: 3m
        labels:
          severity: warning
          category: application
          type: error_rate
        annotations:
          summary: "–í—ã—Å–æ–∫–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç –æ—à–∏–±–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"
          description: "{{ $value | humanizePercentage }} –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞–≤–µ—Ä—à–∞—é—Ç—Å—è —Å –æ—à–∏–±–∫–∞–º–∏ 5xx"

  # ========================================================================
  # –ê–õ–ï–†–¢–´ –ú–û–ù–ò–¢–û–†–ò–ù–ì–ê (Monitoring System Alerts)
  # ========================================================================
  - name: monitoring_health
    rules:
      # Prometheus target –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
      - alert: PrometheusTargetDown
        expr: up == 0
        for: 2m
        labels:
          severity: warning
          category: monitoring
          service: prometheus
        annotations:
          summary: "Prometheus target –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
          description: "Target {{ $labels.job }} ({{ $labels.instance }}) –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –±–æ–ª–µ–µ 2 –º–∏–Ω—É—Ç"

      # Logstash –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç –ª–æ–≥–∏
      - alert: LogstashNoLogs
        expr: rate(logstash_events_total[5m]) == 0
        for: 5m
        labels:
          severity: warning
          category: logging
          service: logstash
        annotations:
          summary: "Logstash –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç –ª–æ–≥–∏"
          description: "Logstash –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª –ª–æ–≥–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –º–∏–Ω—É—Ç"

      # Elasticsearch –∏–Ω–¥–µ–∫—Å—ã —Ä–∞—Å—Ç—É—Ç —Å–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä–æ
      - alert: ElasticsearchIndexGrowthHigh
        expr: increase(elasticsearch_indices_store_size_bytes[1h]) > 1073741824  # 1GB –∑–∞ —á–∞—Å
        for: 0m
        labels:
          severity: warning
          category: storage
          service: elasticsearch
        annotations:
          summary: "–ë—ã—Å—Ç—Ä—ã–π —Ä–æ—Å—Ç –∏–Ω–¥–µ–∫—Å–æ–≤ Elasticsearch"
          description: "–†–∞–∑–º–µ—Ä –∏–Ω–¥–µ–∫—Å–æ–≤ –≤—ã—Ä–æ—Å –Ω–∞ {{ $value | humanizeBytes }} –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å"

  # ========================================================================
  # –ê–õ–ï–†–¢–´ –°–ï–¢–ò –ò –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ô (Network & Connectivity Alerts)
  # ========================================================================
  - name: network_alerts
    rules:
      # –í—ã—Å–æ–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ —Å–µ—Ç–∏
      - alert: HighNetworkLatency
        expr: avg_over_time(probe_duration_seconds[5m]) > 0.5
        for: 3m
        labels:
          severity: warning
          category: network
          type: latency
        annotations:
          summary: "–í—ã—Å–æ–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ —Å–µ—Ç–∏"
          description: "–°—Ä–µ–¥–Ω—è—è –∑–∞–¥–µ—Ä–∂–∫–∞ {{ $value }}s –¥–ª—è {{ $labels.instance }}"

      # –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ TCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
      - alert: TooManyTCPConnections
        expr: node_netstat_Tcp_CurrEstab > 1000
        for: 5m
        labels:
          severity: warning
          category: network
          type: connections
        annotations:
          summary: "–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ TCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π"
          description: "{{ $value }} –∞–∫—Ç–∏–≤–Ω—ã—Ö TCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –Ω–∞ {{ $labels.instance }}"

  # ========================================================================
  # –ê–õ–ï–†–¢–´ –†–ï–°–£–†–°–û–í –ò –õ–ò–ú–ò–¢–û–í (Resource & Limits Alerts)
  # ========================================================================
  - name: resource_limits
    rules:
      # –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç –ø–∞–º—è—Ç–∏
      - alert: ContainerMemoryLimitNear
        expr: (container_memory_usage_bytes / container_spec_memory_limit_bytes) * 100 > 80
        for: 3m
        labels:
          severity: warning
          category: resources
          resource: memory
        annotations:
          summary: "–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –±–ª–∏–∑–æ–∫ –∫ –ª–∏–º–∏—Ç—É –ø–∞–º—è—Ç–∏"
          description: "{{ $labels.name }} –∏—Å–ø–æ–ª—å–∑—É–µ—Ç {{ $value | humanizePercentage }} –æ—Ç –ª–∏–º–∏—Ç–∞ –ø–∞–º—è—Ç–∏"

      # –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç CPU
      - alert: ContainerCPULimitNear
        expr: (rate(container_cpu_usage_seconds_total[5m]) / container_spec_cpu_quota * container_spec_cpu_period) * 100 > 80
        for: 5m
        labels:
          severity: warning
          category: resources
          resource: cpu
        annotations:
          summary: "–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –±–ª–∏–∑–æ–∫ –∫ –ª–∏–º–∏—Ç—É CPU"
          description: "{{ $labels.name }} –∏—Å–ø–æ–ª—å–∑—É–µ—Ç {{ $value | humanizePercentage }} –æ—Ç –ª–∏–º–∏—Ç–∞ CPU"

      # –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
      - alert: ContainerRestartLoop
        expr: increase(kube_pod_container_status_restarts_total[15m]) > 3
        for: 0m
        labels:
          severity: critical
          category: stability
          type: restart_loop
        annotations:
          summary: "üîÑ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤ —Ü–∏–∫–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–≤"
          description: "–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä {{ $labels.container }} –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–ª—Å—è {{ $value }} —Ä–∞–∑ –∑–∞ 15 –º–∏–Ω—É—Ç"

  # ========================================================================
  # –ê–õ–ï–†–¢–´ –†–ï–ó–ï–†–í–ù–û–ì–û –ö–û–ü–ò–†–û–í–ê–ù–ò–Ø (Backup Alerts)
  # ========================================================================
  - name: backup_alerts
    rules:
      # –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–ª–æ—Å—å
      - alert: BackupNotCompleted
        expr: time() - backup_last_success_timestamp > 86400  # 24 —á–∞—Å–∞
        for: 0m
        labels:
          severity: critical
          category: backup
          service: "{{ $labels.service }}"
        annotations:
          summary: "üö® –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–ª–æ—Å—å"
          description: "–ü–æ—Å–ª–µ–¥–Ω–∏–π —É—Å–ø–µ—à–Ω—ã–π –±—ç–∫–∞–ø {{ $labels.service }} –±—ã–ª {{ $value | humanizeDuration }} –Ω–∞–∑–∞–¥"

      # –ë—ç–∫–∞–ø –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –æ—à–∏–±–∫–æ–π
      - alert: BackupFailed
        expr: backup_success == 0
        for: 0m
        labels:
          severity: critical
          category: backup
          service: "{{ $labels.service }}"
        annotations:
          summary: "‚ùå –û—à–∏–±–∫–∞ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è"
          description: "–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ {{ $labels.service }} –∑–∞–≤–µ—Ä—à–∏–ª–æ—Å—å —Å –æ—à–∏–±–∫–æ–π"

  # ========================================================================
  # –ê–õ–ï–†–¢–´ BUSINESS –ú–ï–¢–†–ò–ö (Business Metrics Alerts) 
  # ========================================================================
  - name: business_alerts
    rules:
      # –ù–∏–∑–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
      - alert: LowUserActivity
        expr: rate(user_requests_total[1h]) < 10
        for: 15m
        labels:
          severity: warning
          category: business
          type: user_activity
        annotations:
          summary: "–ù–∏–∑–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"
          description: "–¢–æ–ª—å–∫–æ {{ $value }} –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å"

      # –í—ã—Å–æ–∫–æ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ API
      - alert: HighAPIResponseTime
        expr: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m])) > 2
        for: 3m
        labels:
          severity: warning
          category: performance
          component: api
        annotations:
          summary: "–í—ã—Å–æ–∫–æ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ API"
          description: "95-–π –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—å –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞ API: {{ $value }}s"