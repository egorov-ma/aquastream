# CI/CD –¥–ª—è AquaStream

–î–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏ –¥–æ—Å—Ç–∞–≤–∫–∏ (CI/CD) –ø—Ä–æ–µ–∫—Ç–∞ AquaStream, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–∏ –ø–æ–º–æ—â–∏ GitHub Actions.

## –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

```
[–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫] ‚Üí push / PR ‚Üí GitHub Actions ‚Üí  üß™  –¢–µ—Å—Ç—ã  ‚Üí  üèó  –°–±–æ—Ä–∫–∏  ‚Üí  üì¶  –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã  ‚Üí  üöÄ  –î–µ–ø–ª–æ–π
```

–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–ª–æ—è —Å–∏—Å—Ç–µ–º—ã (backend, frontend) –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–∞–π–ø–ª–∞–π–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ —Å–±–æ—Ä–∫–∏. –î–µ–ø–ª–æ–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–º workflow –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é (–∏–ª–∏ –∏–∑ –¥—Ä—É–≥–∏—Ö workflow –≤ –±—É–¥—É—â–µ–º).

| Workflow | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –¢—Ä–∏–≥–≥–µ—Ä—ã |
|----------|-----------|----------|
| `backend-ci.yml`   | –°–±–æ—Ä–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π —á–∞—Å—Ç–∏, –≤–∞–ª–∏–¥–∞—Ü–∏—è `docker-compose.yml` | push / PR ‚Üí –≤–µ—Ç–∫–∏ `main`, `develop` |
| `frontend-ci.yml`  | TSLint, type-check, unit-—Ç–µ—Å—Ç—ã, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–æ–≤ –ø–æ–∫—Ä—ã—Ç–∏—è, —Å–±–æ—Ä–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ | push / PR, –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ `frontend/` |
| `deploy.yml`       | –°–±–æ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑–æ–≤ –≤—Å–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –¥–µ–ø–ª–æ–π (–∑–∞–≥–ª—É—à–∫–∞) | —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ (`workflow_dispatch`) |

---

## `backend-ci.yml`

```yaml
name: Backend CI
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ job-–æ–≤

1. **test** ‚Äì –∑–∞–ø—É—Å–∫–∞–µ—Ç unit-—Ç–µ—Å—Ç—ã –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π backend-—á–∞—Å—Ç–∏.
   - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –∫—ç—à Gradle.
   - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∫–∞–∫ artifact `backend-test-reports`.
2. **build** ‚Äì —Å–±–æ—Ä–∫–∞ JAR-—Ñ–∞–π–ª–æ–≤ (`./gradlew build -x test`) –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤.
   - –ê—Ä—Ç–µ—Ñ–∞–∫—Ç: `backend-build` —Å–æ –≤—Å–µ–º–∏ JAR-–∞–º–∏.
3. **compose-validate** ‚Äì –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ñ–∞–π–ª–∞ `infra/docker/compose/docker-compose.yml` –ø—Ä–∏ –ø–æ–º–æ—â–∏ `docker compose config`.

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∫—ç—à Gradle (`actions/setup-java@v4 cache: 'gradle'`). –≠—Ç–æ —É—Å–∫–æ—Ä—è–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ —Å–±–æ—Ä–∫–∏.

---

## `frontend-ci.yml`

```yaml
name: Frontend CI
```

Workflow –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ç–∞–ª–æ–≥–∞ `frontend/`.

### build-test job

- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è Node.js 18.x.
- –ö—ç—à–∏—Ä—É—é—Ç—Å—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ `npm`.
- –í—ã–ø–æ–ª–Ω—è—é—Ç—Å—è:
  1. `npm run lint` ‚Äì –ª–∏–Ω—Ç–∏–Ω–≥ ESLint.
  2. `tsc --noEmit` ‚Äì —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤.
  3. `npm run test:ci` ‚Äì —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã + –æ—Ç—á—ë—Ç –ø–æ–∫—Ä—ã—Ç–∏—è.
  4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–µ–π–¥–∂–µ–π –ø–æ–∫—Ä—ã—Ç–∏—è (`scripts/generate-coverage-badge.js`).
  5. `npm run build` ‚Äì –ø—Ä–æ–¥-—Å–±–æ—Ä–∫–∞ Vite.
- –ò—Ç–æ–≥–æ–≤—ã–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã:
  - `coverage-report` ‚Äì –æ—Ç—á—ë—Ç—ã –ø–æ–∫—Ä—ã—Ç–∏—è.
  - `frontend-build` ‚Äì –ø–∞–ø–∫–∞ `dist/`.

---

## `deploy.yml`

–ü–æ–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –∑–∞–≥–ª—É—à–∫—É.

1. –ö–ª–æ–Ω–∏—Ä—É–µ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.
2. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç Docker Buildx.
3. –í—ã–ø–æ–ª–Ω—è–µ—Ç `docker compose build`, —Å–æ–±–∏—Ä–∞—è –≤—Å–µ –æ–ø–∏—Å–∞–Ω–Ω—ã–µ –≤ `infra/docker/compose/docker-compose.yml` –æ–±—Ä–∞–∑—ã.
4. **TODO**: –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–Ω –≤ Docker Registry, push –æ–±—Ä–∞–∑–æ–≤ –∏ –¥–µ–ø–ª–æ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ Kubernetes/GitHub Environments).

---

## –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π workflow

1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –≤ `.github/workflows/` —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º.
2. –°–ª–µ–¥—É–π—Ç–µ –∫–æ–Ω–≤–µ–Ω—Ü–∏—è–º –∏–º–µ–Ω–∏: `<area>-ci.yml` –¥–ª—è CI, `deploy-<env>.yml` –¥–ª—è –¥–µ–ø–ª–æ—è.
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (`actions/setup-java`, `actions/setup-node`) –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è.
4. –ö–∞–∂–¥—ã–π workflow –¥–æ–ª–∂–µ–Ω –∑–∞–≥—Ä—É–∂–∞—Ç—å –ø–æ–ª–µ–∑–Ω—ã–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã (build, –æ—Ç—á—ë—Ç—ã) —á–µ—Ä–µ–∑ `actions/upload-artifact`.

---

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ —Å–µ–∫—Ä–µ—Ç—ã

- **`GH_TOKEN`** ‚Äì —Ç–æ–∫–µ–Ω GitHub, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ—Å—Ç—É–ø–µ–Ω –≤ —Ä–∞–Ω–Ω–µ—Ä–∞—Ö (`secrets.GITHUB_TOKEN`).
- **`DOCKERHUB_USERNAME`** / **`DOCKERHUB_TOKEN`** ‚Äì –ø–æ—Ç—Ä–µ–±—É—é—Ç—Å—è –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —ç—Ç–∞–ø–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –æ–±—Ä–∞–∑–æ–≤.
- **`KUBE_CONFIG`** ‚Äì –∫–æ–Ω—Ñ–∏–≥ k8s-–∫–ª–∞—Å—Ç–µ—Ä–∞, –µ—Å–ª–∏ –¥–µ–ø–ª–æ–π –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –Ω–∞–ø—Ä—è–º—É—é.

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ —Ä–∞–∑–¥–µ–ª–µ *Settings ‚Üí Secrets and variables ‚Üí Actions*.

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ CI/CD

- –†–∞–∑–¥–µ–ª—è–π—Ç–µ —Ç–µ—Å—Ç—ã –∏ —Å–±–æ—Ä–∫—É –Ω–∞ —Ä–∞–∑–Ω—ã–µ job-—ã, —á—Ç–æ–±—ã –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–ª–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.
- –°—Ç–∞—Ä–∞–π—Ç–µ—Å—å –¥–µ—Ä–∂–∞—Ç—å –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å CI < 10 –º–∏–Ω—É—Ç.
- –§–∏–∫—Å–∏—Ä—É–π—Ç–µ –≤–µ—Ä—Å–∏–∏ action-–æ–≤ (`@v4`, `@v3`), —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π.
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–µ–π–¥–∂–∏ —Å—Ç–∞—Ç—É—Å–∞ –≤ README –º–æ–¥—É–ª–µ–π:
  ```markdown
  ![Backend CI](https://github.com/<ORG>/aquastream/actions/workflows/backend-ci.yml/badge.svg)
  ``` 