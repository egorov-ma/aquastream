# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Å–∫—Ä–∏–ø—Ç—É api-check.sh

## –û–±–∑–æ—Ä

–°–∫—Ä–∏–ø—Ç `api-check.sh` –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ AquaStream: Frontend –∏ API Gateway. –°–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–æ–∫ –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —É–¥–æ–±–Ω–æ–º –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–µ —Å —Ü–≤–µ—Ç–æ–≤–æ–π –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞—Ü–∏–µ–π.

## –ü—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å —Å–∫—Ä–∏–ø—Ç–∞ - –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –±—ã—Å—Ç—Ä—ã–π –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∫–ª—é—á–µ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞ –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∑–∞–ø—É—Å–∫–∞ –ø–æ–ª–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤. –≠—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–Ω–æ –ø—Ä–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ –ø—Ä–æ–±–ª–µ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –º–µ–∂–¥—É Frontend –∏ API.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

–°–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:

1. **–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Frontend**
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ Frontend –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É http://localhost:3000

2. **–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API —á–µ—Ä–µ–∑ Frontend**
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ API –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ Frontend-–ø—Ä–æ–∫—Å–∏ –ø–æ –∞–¥—Ä–µ—Å—É http://localhost:3000/api/actuator/health
   - –≠—Ç–æ –≤–∞–∂–Ω–æ, —Ç–∞–∫ –∫–∞–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∫–ª–∏–µ–Ω—Ç –æ–±—ã—á–Ω–æ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ API —á–µ—Ä–µ–∑ Frontend

3. **–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API –Ω–∞–ø—Ä—è–º—É—é** (–µ—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Frontend –Ω–µ –ø—Ä–æ—à–ª–∞)
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –¥–æ—Å—Ç—É–ø–µ–Ω –ª–∏ API –Ω–∞–ø—Ä—è–º—É—é –ø–æ –∞–¥—Ä–µ—Å—É http://localhost:8080/actuator/health
   - –ü–æ–º–æ–≥–∞–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –ø—Ä–æ–±–ª–µ–º–∞ –≤ —Å–∞–º–æ–º API –∏–ª–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è

4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ Docker**
   - –í—ã–≤–æ–¥–∏—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –≤ —Å–µ—Ç–∏ `docker_aquastream-network` —Å –∏—Ö IP-–∞–¥—Ä–µ—Å–∞–º–∏
   - –ü–æ–∑–≤–æ–ª—è–µ—Ç —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –Ω—É–∂–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –æ–¥–Ω–æ–π —Å–µ—Ç–∏ –∏ –º–æ–≥—É—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å

5. **–ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Nginx**
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Nginx –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ Frontend
   - –ü–æ–º–æ–≥–∞–µ—Ç –≤—ã—è–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

–°–∫—Ä–∏–ø—Ç –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–æ—Å—Ç–æ–π –∫–æ–º–∞–Ω–¥–æ–π:

```bash
./api-check.sh
```

## –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞

```
–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ frontend (http://localhost:3000)...
‚úÖ Frontend –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ http://localhost:3000

–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API —á–µ—Ä–µ–∑ frontend proxy (http://localhost:3000/api/actuator/health)...
‚úÖ API –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ frontend proxy –Ω–∞ http://localhost:3000/api/actuator/health

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ Docker...
–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤ —Å–µ—Ç–∏ docker_aquastream-network:
aquastream-api 192.168.16.11/16
aquastream-frontend 192.168.16.10/16
aquastream-postgres 192.168.16.5/16
aquastream-kafka 192.168.16.7/16
aquastream-zookeeper 192.168.16.6/16

–ü—Ä–æ–≤–µ—Ä–∫–∞ Nginx-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ frontend:
...
server {
    listen 80;
    server_name localhost;

    location / {
        root /usr/share/nginx/html;
        index index.html;
        try_files $uri $uri/ /index.html;
    }

    location /api/ {
        proxy_pass http://api-gateway:8080/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
...
```

## –ö–æ–¥—ã –≤–æ–∑–≤—Ä–∞—Ç–∞

- **0** - –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã
- **1** - –û–¥–Ω–∞ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–æ–∫ –Ω–µ –ø—Ä–æ—à–ª–∏

## –¶–≤–µ—Ç–æ–≤—ã–µ –æ–±–æ–∑–Ω–∞—á–µ–Ω–∏—è

- **–ó–µ–ª–µ–Ω—ã–π** (‚úÖ) - –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω–∞
- **–ö—Ä–∞—Å–Ω—ã–π** (‚ùå) - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ –ø—Ä–æ–π–¥–µ–Ω–∞, –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞
- **–ñ–µ–ª—Ç—ã–π** (üëâ) - –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –∏–ª–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

## –¢–∏–ø–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

```bash
./api-check.sh
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

```bash
# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ docker-compose.yml
vim docker-compose.yml

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
./restart.sh -r

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
./api-check.sh
```

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
./api-check.sh

# –ï—Å–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã, –ø—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏
docker logs aquastream-frontend
docker logs aquastream-api
```

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ —Ç–∏–ø–∏—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º

### Frontend –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

–ï—Å–ª–∏ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ Frontend –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. –ó–∞–ø—É—â–µ–Ω –ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä Frontend: `docker ps | grep frontend`
2. –õ–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞: `docker logs aquastream-frontend`
3. –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ—Ä—Ç–∞ 3000: `netstat -tulpn | grep 3000`

### API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ Frontend, –Ω–æ –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞–ø—Ä—è–º—É—é

–≠—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–æ–±–ª–µ–º—É —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è –≤ Nginx. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Nginx –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è
2. –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –∞–ª–∏–∞—Å–æ–≤ –≤ —Å–µ—Ç–∏ Docker
3. –î–æ–±–∞–≤—å—Ç–µ –≤ docker-compose.yml –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ api-gateway:
   ```yaml
   networks:
     aquastream-network:
       aliases:
         - api-gateway
   ```

### API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∏ —á–µ—Ä–µ–∑ Frontend, –Ω–∏ –Ω–∞–ø—Ä—è–º—É—é

–ü—Ä–æ–±–ª–µ–º–∞ –≤ —Å–∞–º–æ–º API. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. –ó–∞–ø—É—â–µ–Ω –ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä API: `docker ps | grep api`
2. –õ–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞: `docker logs aquastream-api`
3. –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ docker-compose.yml

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ —Å–∫—Ä–∏–ø—Ç–∞–º–∏

–°–∫—Ä–∏–ø—Ç `api-check.sh` –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤–º–µ—Å—Ç–µ —Å –¥—Ä—É–≥–∏–º–∏ —Å–∫—Ä–∏–ø—Ç–∞–º–∏ –¥–ª—è –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
./restart.sh -r -b

# –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–µ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
./api-check.sh

# –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã, –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
./check.sh -p
``` 