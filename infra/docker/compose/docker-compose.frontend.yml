name: aquastream-frontend

services:
  frontend-dev:
    build:
      context: ../../..
      dockerfile: infra/docker/images/Dockerfile.frontend.next
    command: sh -c "npm i -g pnpm@10.14.0 && pnpm install --frozen-lockfile && pnpm dev -p 3100 --hostname 0.0.0.0"
    working_dir: /app/frontend
    environment:
      - NEXT_PUBLIC_APP_ENV=dev
      - NEXT_PUBLIC_USE_MOCKS=true
      - NEXT_PUBLIC_API_BASE_URL=http://api-gateway:8080
      - PORT=3100
      - NODE_ENV=development
      - CI=1
    ports:
      - "3100:3100"
    volumes:
      - ../../..:/app
    tty: true
    stdin_open: true
    profiles: ["dev"]

  frontend:
    build:
      context: ../../..
      dockerfile: infra/docker/images/Dockerfile.frontend.next
    environment:
      - NEXT_PUBLIC_APP_ENV=prod
      - NEXT_PUBLIC_USE_MOCKS=false
    ports:
      - "3000:3000"
    healthcheck:
      test: ["CMD", "node", "-e", "fetch('http://localhost:3000').then(r=>process.exit(r.ok?0:1)).catch(()=>process.exit(1))"]
      interval: 10s
      timeout: 3s
      retries: 5
    profiles: ["prod"]


