# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ –¥–ª—è –Ω–µ–±–æ–ª—å—à–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏

## üìä –ê–Ω–∞–ª–∏–∑ –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤

### üéØ –¶–µ–ª–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- **–ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏** –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU** —Å —É—á–µ—Ç–æ–º –Ω–µ–±–æ–ª—å—à–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏
- **–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π** —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ JVM –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
- **–°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞** –ø–æ–¥ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏

## üìã –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å–µ—Ä–≤–∏—Å–æ–≤ –∏ –∏—Ö –ª–∏–º–∏—Ç—ã

### üî∏ MICRO (CPU: 0.05, RAM: 64M)
**Placeholder —Å–µ—Ä–≤–∏—Å—ã** - –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–≥–ª—É—à–∫–∏
- **crew-service** - –∑–∞–≥–ª—É—à–∫–∞ —ç–∫–∏–ø–∞–∂–∞
- **event-service** - –∑–∞–≥–ª—É—à–∫–∞ —Å–æ–±—ã—Ç–∏–π  
- **notification-service** - –∑–∞–≥–ª—É—à–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- **frontend** - —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã —á–µ—Ä–µ–∑ nginx

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤-–∑–∞–≥–ª—É—à–µ–∫

### üîπ TINY (CPU: 0.15, RAM: 192M)
**–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã —Å JVM** - —Ä–µ–∞–ª—å–Ω—ã–µ Spring Boot –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- **user-service** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- **api-gateway** - –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è API

**JVM –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
- Initial heap: 96M
- Max heap: 160M  
- G1GC –¥–ª—è –Ω–∏–∑–∫–æ–≥–æ pause time
- Container-aware –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### üî∫ SMALL (CPU: 0.3, RAM: 384M)
**–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã**
- **nginx** - reverse proxy
- **zookeeper** - –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è Kafka
- **kafka** - –±—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π
- **logstash** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ª–æ–≥–æ–≤ (128m heap)
- **kibana** - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–æ–≤
- **prometheus** - —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫
- **grafana** - –¥–∞—à–±–æ—Ä–¥—ã

### üî∂ MEDIUM (CPU: 0.6, RAM: 768M)
**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** —Å —É–º–µ—Ä–µ–Ω–Ω—ã–º –∫—ç—à–µ–º
- **postgres** - –æ—Å–Ω–æ–≤–Ω–∞—è –ë–î —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –¥–ª—è –Ω–µ–±–æ–ª—å—à–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏

### üî¥ BIG (CPU: 0.8, RAM: 1536M)
**–ü–æ–∏—Å–∫–æ–≤—ã–π –¥–≤–∏–∂–æ–∫** - —Å–∞–º—ã–π —Ä–µ—Å—É—Ä—Å–æ–µ–º–∫–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
- **elasticsearch** - –ø–æ–∏—Å–∫ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

**ES –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
- Heap: 512m-1024m (G1GC)
- Single node —Ä–µ–∂–∏–º
- –ë–∞–∑–æ–≤–∞—è –ª–∏—Ü–µ–Ω–∑–∏—è

## üßÆ –û–±—â–µ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤

### CPU (—Å—É–º–º–∞—Ä–Ω–æ: ~3.5 —è–¥—Ä–∞)
```
Elasticsearch:     0.8 —è–¥—Ä–∞  (23%)
PostgreSQL:        0.6 —è–¥—Ä–∞  (17%)
–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞:    1.8 —è–¥—Ä–∞  (51%)
–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã:      0.3 —è–¥—Ä–∞  (9%)
```

### Memory (—Å—É–º–º–∞—Ä–Ω–æ: ~4.6GB)
```
Elasticsearch:     1536M     (33%)
PostgreSQL:        768M      (17%)
–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞:    1920M     (42%)
–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã:      384M      (8%)
```

## ‚ö° JVM –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã (192M –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä)
```bash
-Xms96m -Xmx160m              # Heap 96-160M
-XX:+UseG1GC                  # G1 –¥–ª—è –Ω–∏–∑–∫–æ–π –ø–∞—É–∑—ã
-XX:MaxGCPauseMillis=100      # –¶–µ–ª—å –ø–∞—É–∑—ã 100ms
-XX:+UseContainerSupport      # –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä-aware
-XX:MaxRAMPercentage=80.0     # 80% –æ—Ç –ª–∏–º–∏—Ç–∞
```

### Elasticsearch (1536M –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä)
```bash
-Xms512m -Xmx1024m           # Heap 512M-1GB
-XX:+UseG1GC                 # G1 –¥–ª—è –ø–æ–∏—Å–∫–∞
-XX:MaxGCPauseMillis=200     # –¶–µ–ª—å –ø–∞—É–∑—ã 200ms
```

### Logstash (384M –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä)
```bash
-Xms128m -Xmx128m           # –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π heap 128M
```

## üîß –°–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### PostgreSQL
- **shared_buffers**: ~128MB (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- **effective_cache_size**: ~384MB
- **work_mem**: 4MB (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- **maintenance_work_mem**: 64MB

### Kafka
- **Heap**: JVM –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (~200-300M)
- **Log retention**: 7 –¥–Ω–µ–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- **Batch size**: —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –¥–ª—è –Ω–µ–±–æ–ª—å—à–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏

### Nginx
- **worker_processes**: auto (1-2 –Ω–∞ –Ω–µ–±–æ–ª—å—à–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ)
- **worker_connections**: 1024 (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ)
- **–ö—ç—à —Å—Ç–∞—Ç–∏–∫–∏**: 50M tmpfs

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤

### Prometheus –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:
```yaml
# Memory usage
container_memory_usage_bytes
container_memory_limit_bytes

# CPU usage  
rate(container_cpu_usage_seconds_total[5m])
container_spec_cpu_quota

# JVM metrics (–¥–ª—è Java –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π)
jvm_memory_used_bytes
jvm_gc_collection_seconds
```

### –ê–ª–µ—Ä—Ç—ã –¥–ª—è –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤:
- Memory usage > 85%
- CPU usage > 80% (–∑–∞ 5 –º–∏–Ω—É—Ç)
- GC pause time > 500ms

## üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é

### –ü—Ä–∏ —Ä–æ—Å—Ç–µ –Ω–∞–≥—Ä—É–∑–∫–∏ —É–≤–µ–ª–∏—á–∏—Ç—å:
1. **API Gateway**: –¥–æ SMALL (0.3 CPU, 384M RAM)
2. **User Service**: –¥–æ SMALL –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö
3. **PostgreSQL**: –¥–æ BIG —Å —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–º shared_buffers
4. **Elasticsearch**: heap –¥–æ 2GB –ø—Ä–∏ —Ä–æ—Å—Ç–µ –¥–∞–Ω–Ω—ã—Ö

### –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:
- –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã: –¥–æ–±–∞–≤–∏—Ç—å replica –∑–∞ load balancer
- Elasticsearch: –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ multi-node –∫–ª–∞—Å—Ç–µ—Ä
- PostgreSQL: master-slave —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è

## ‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

1. **–ù–µ —Å–Ω–∏–∂–∞–π—Ç–µ –ª–∏–º–∏—Ç—ã –Ω–∏–∂–µ** —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
2. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ OOM kills** –≤ –ª–æ–≥–∞—Ö Docker
3. **JVM heap –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å** 75% –æ—Ç –ª–∏–º–∏—Ç–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
4. **G1GC –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–ª—è—Ç—å –±–æ–ª—å—à–µ CPU**, –Ω–æ –¥–∞–µ—Ç –ª—É—á—à—É—é –æ—Ç–∑—ã–≤—á–∏–≤–æ—Å—Ç—å

## üìù –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### 2024-08-02 - –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- –°–æ–∑–¥–∞–Ω–∏–µ 5 –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ä–µ—Å—É—Ä—Å–Ω—ã—Ö –ª–∏–º–∏—Ç–æ–≤
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è JVM –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–ª—è Java –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- –ü–µ—Ä–µ–≤–æ–¥ placeholder —Å–µ—Ä–≤–∏—Å–æ–≤ –Ω–∞ MICRO –ª–∏–º–∏—Ç—ã
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Elasticsearch heap –¥–ª—è –Ω–µ–±–æ–ª—å—à–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏