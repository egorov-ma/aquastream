# Бизнес-требования

## Назначение и контекст

**AquaStream** — платформа-агрегатор коммерческих мероприятий (водные сплавы, походы, outdoor активности).

### Целевая аудитория

**Пользователи** (Участники):
- Ищут организаторов и их события
- Записываются и оплачивают участие
- Управляют своими бронированиями
- Участвуют в экипажах

**Организаторы**:
- Ведут бренд-страницу компании
- Публикуют события
- Управляют командой и FAQ
- Подтверждают оплаты (QR модерация)
- Управляют экипажами/размещением

**Администраторы**:
- Управляют ролями пользователей
- Модерируют контент
- Системные настройки

## Цели продукта

1. **Единый каталог** организаторов и их событий
2. **Удобная запись** с простым процессом бронирования
3. **Гибкая оплата**:
   - Виджет эквайринга (YooKassa/CloudPayments/Stripe)
   - QR на счет организатора с ручным подтверждением
4. **Командообразование** - экипажи, палатки, столы на уровне события
5. **Telegram-уведомления** - обязательные и опциональные
6. **Современный UI** - быстрый, адаптивный, темная/светлая тема

## Область MVP

### ✅ Включено в MVP

#### Публичная часть
- Каталог организаторов с поиском
- Страницы организатора (бренд, команда, FAQ)
- Список и детали событий
- Фильтры событий (дата, цена, вместимость)

#### Аутентификация
- Регистрация (username+password)
- Вход/выход
- Восстановление пароля через Telegram

#### Профиль
- Управление профилем
- Телефон или Telegram (обязательно для бронирования)
- Дополнительные поля (JSON)

#### Бронирование
- Создание брони (TTL 30 минут)
- Просмотр своих бронирований
- Отмена бронирования
- Waitlist для переполненных событий

#### Оплата
- Виджет эквайринга (YooKassa приоритетно)
- QR-оплата на счет организатора
- Ручная модерация QR-платежей
- История платежей

#### Организатор ЛК
- Создание/редактирование бренда
- Управление командой и FAQ
- CRUD событий (черновик → публикация)
- Подтверждение QR-оплат
- Управление экипажами

#### Экипажи
- Простые списки групп
- Ручное назначение участников
- Типы: экипажи, палатки, столы, транспорт

#### Уведомления
- Telegram бот
- Обязательные: оплата, напоминания
- Опциональные: новости, освободившиеся места
- Настройки подписок

#### UI/UX
- Тёмная и светлая тема
- Адаптив для web + mobile
- Tailwind CSS + shadcn/ui
- Accessibility (ARIA, keyboard navigation)

### ❌ Вне MVP (Roadmap)

- Автоматическая раскладка команд (алгоритм)
- Расширенная аналитика для организаторов
- Email-канал уведомлений
- SMS уведомления
- Сложные биллинговые сценарии
- Multi-currency
- Возврат средств (refunds)
- Рекуррентные платежи
- Gift certificates

## Функциональные требования

### FR-1: Регистрация

- Пользователь может зарегистрироваться через email + password
- Email должен быть уникальным
- Пароль: минимум 12 символов (uppercase, lowercase, digit, special char)
- После регистрации автоматический вход (получение JWT)

### FR-2: Аутентификация

- Вход через email + password
- JWT access token (TTL 1 час)
- JWT refresh token (TTL 30 дней)
- Автоматическое обновление токенов
- Logout с revoke refresh token

### FR-3: Бронирование

- Пользователь может забронировать событие
- Обязательно: заполненный профиль (phone ИЛИ telegram)
- Бронь создается в статусе PENDING
- TTL брони: 30 минут до оплаты
- Автоматическое истечение неоплаченных броней
- Не более одной активной брони на событие

### FR-4: Оплата

- Два метода: виджет эквайринга и QR
- Виджет: интеграция с YooKassa/CloudPayments/Stripe
- QR: загрузка скриншота + модерация организатором
- Webhook для автоподтверждения (виджет)
- История всех платежей

### FR-5: Waitlist

- Автоматическая очередь при отсутствии мест
- FIFO порядок
- Уведомление при освобождении места
- Окно для брони: 30 минут

### FR-6: Экипажи

- Создание групп с типом и capacity
- Назначение участников организатором
- Учет предпочтений (опционально)

## Нефункциональные требования

### NFR-1: Производительность

- Время загрузки главной: < 3 секунды
- Время ответа API: p95 < 500ms
- Lighthouse Performance: ≥ 90

### NFR-2: Доступность

- Uptime: 99.9%
- Graceful degradation при сбоях
- Health checks всех сервисов

### NFR-3: Безопасность

- HTTPS обязательно в production
- JWT с сильным секретом
- Rate limiting на критичных endpoints
- Security headers
- Container security (non-root, read-only)
- Regular security scanning

### NFR-4: Масштабируемость

- Горизонтальное масштабирование сервисов
- Connection pooling (БД, Redis)
- Кэширование часто запрашиваемых данных
- CDN для статики

### NFR-5: Совместимость

- Браузеры: Chrome, Firefox, Safari, Edge (последние 2 версии)
- Устройства: desktop, tablet, mobile
- Разрешения: 375px - 1920px

## См. также

- [User Journeys](user-journeys.md) - пользовательские сценарии
- [Processes](processes.md) - бизнес-процессы
- [Roadmap](roadmap.md) - дорожная карта развития
