# AquaStream Backend Media Service

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–µ–¥–∏–∞—Ñ–∞–π–ª–∞–º–∏ (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –¥–æ–∫—É–º–µ–Ω—Ç—ã, –≤–∏–¥–µ–æ) —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤, –ø–æ–ª–∏—Ç–∏–∫ –¥–æ—Å—Ç—É–ø–∞, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π —Å MinIO S3-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º.

## –û–ø–∏—Å–∞–Ω–∏–µ

`backend-media` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ–º–∏ –º–µ–¥–∏–∞—Ñ–∞–π–ª–∞–º–∏ –≤ —Å–∏—Å—Ç–µ–º–µ AquaStream:
- –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
- –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞ (–ø—É–±–ª–∏—á–Ω—ã–µ, –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ, unlisted)
- Presigned URLs –¥–ª—è –ø—Ä—è–º–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –≤ S3-—Ö—Ä–∞–Ω–∏–ª–∏—â–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–æ–≤ –∏ —Ä–∞–∑–º–µ—Ä–æ–≤ —Ñ–∞–π–ª–æ–≤
- –ê—É–¥–∏—Ç –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ–ø–µ—Ä–∞—Ü–∏–π

–°–µ—Ä–≤–∏—Å —Å–ª–µ–¥—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø–∞–º —á–∏—Å—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –º–æ–¥–µ–ª–∏.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ú—É–ª—å—Ç–∏–º–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
backend-media/
‚îú‚îÄ‚îÄ backend-media-api/        # REST –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –∏ DTO
‚îÇ   ‚îú‚îÄ‚îÄ controller/          # REST endpoints
‚îÇ   ‚îú‚îÄ‚îÄ config/             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API
‚îÇ   ‚îî‚îÄ‚îÄ exception/          # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ API
‚îú‚îÄ‚îÄ backend-media-service/   # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ service/            # –ë–∏–∑–Ω–µ—Å-—Å–µ—Ä–≤–∏—Å—ã
‚îÇ   ‚îú‚îÄ‚îÄ storage/            # –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
‚îÇ   ‚îú‚îÄ‚îÄ validation/         # –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ scheduler/          # –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ –æ—á–∏—Å—Ç–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ dto/                # Data Transfer Objects
‚îî‚îÄ‚îÄ backend-media-db/       # –°–ª–æ–π –¥–∞–Ω–Ω—ã—Ö
    ‚îú‚îÄ‚îÄ entity/             # JPA Entity –∫–ª–∞—Å—Å—ã
    ‚îú‚îÄ‚îÄ repository/         # Spring Data JPA —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
    ‚îî‚îÄ‚îÄ migration/          # Liquibase –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### üìÅ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞–º–∏
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–µ—Å—Ç—Ä –≤—Å–µ—Ö –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤
- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ: —Ä–∞–∑–º–µ—Ä, —Ç–∏–ø, checksum, –≤–ª–∞–¥–µ–ª–µ—Ü
- –°—Ç–∞—Ç—É—Å—ã –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞: UPLOADING ‚Üí UPLOADED ‚Üí READY ‚Üí DELETED
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π

#### üîê –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞
- **PRIVATE** - –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª—å—Ü—É
- **PUBLIC** - –ø—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏  
- **UNLISTED** - –¥–æ—Å—Ç—É–ø –ø–æ –ø—Ä—è–º–æ–π —Å—Å—ã–ª–∫–µ

#### ‚òÅÔ∏è S3-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
- MinIO –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
- Presigned URLs –¥–ª—è –ø—Ä—è–º–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ lifecycle –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏

#### üßπ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞
- Scheduled –∑–∞–¥–∞—á–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–∏—Å—à–∏—Ö –∑–∞–≥—Ä—É–∑–æ–∫
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π –æ—á–∏—Å—Ç–∫–∏

## –î–æ–º–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏

#### MediaFileEntity - –ú–µ–¥–∏–∞—Ñ–∞–π–ª—ã
- **id** - –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- **key** - –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –ø—É—Ç—å —Ñ–∞–π–ª–∞ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
- **ownerType** - –¢–∏–ø –≤–ª–∞–¥–µ–ª—å—Ü–∞ (USER, EVENT, ORGANIZER, etc.)
- **ownerId** - –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≤–ª–∞–¥–µ–ª—å—Ü–∞
- **checksum** - SHA-256 —Ö–µ—à –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏
- **contentType** - MIME-—Ç–∏–ø —Ñ–∞–π–ª–∞
- **sizeBytes** - –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –≤ –±–∞–π—Ç–∞—Ö
- **originalFilename** - –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –∏–º—è —Ñ–∞–π–ª–∞
- **status** - –°—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ (UPLOADING, UPLOADED, READY, DELETED)
- **visibility** - –ü–æ–ª–∏—Ç–∏–∫–∞ –¥–æ—Å—Ç—É–ø–∞ (PRIVATE, PUBLIC, UNLISTED)
- **expiresAt** - –í—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

#### CleanupLogEntity - –õ–æ–≥ –æ—á–∏—Å—Ç–∫–∏
- **id** - –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Å–∏
- **cleanedAt** - –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ—á–∏—Å—Ç–∫–∏
- **filesDeleted** - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

### –¢–∏–ø—ã –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤ —Ñ–∞–π–ª–æ–≤

#### USER
- –ê–≤–∞—Ç–∞—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ü—Ä–∏–ª–æ–∂–µ–Ω–Ω—ã–µ –∫ –ø—Ä–æ—Ñ–∏–ª—é –¥–æ–∫—É–º–µ–Ω—Ç—ã
- –õ–∏—á–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ —á–∞—Ç–∞—Ö

#### EVENT  
- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏—è (–æ–±–ª–æ–∂–∫–∏, –≥–∞–ª–µ—Ä–µ—è)
- –î–æ–∫—É–º–µ–Ω—Ç—ã –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è (–ø—Ä–æ–≥—Ä–∞–º–º—ã, –∫–∞—Ä—Ç—ã)
- –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤

#### ORGANIZER
- –õ–æ–≥–æ—Ç–∏–ø—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
- –î–æ–∫—É–º–µ–Ω—Ç—ã –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –†–µ–∫–ª–∞–º–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

#### PROFILE
- –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è
- –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
- –î–æ–∫—É–º–µ–Ω—Ç—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–ø—ã—Ç–∞

#### SYSTEM
- –î–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- –®–∞–±–ª–æ–Ω—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

### –°—Ç–∞—Ç—É—Å—ã —Ñ–∞–π–ª–æ–≤

#### UPLOADING
- –§–∞–π–ª –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –∑–∞–≥—Ä—É–∑–∫–∏
- –ú–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–ø–æ–ª–Ω—ã–º
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —á–µ—Ä–µ–∑ 24 —á–∞—Å–∞

#### UPLOADED
- –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
- –§–∞–π–ª –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –ë–∞–∑–æ–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã

#### READY
- –§–∞–π–ª –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
- –í—Å–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã
- –î–æ—Å—Ç—É–ø–µ–Ω —Å–æ–≥–ª–∞—Å–Ω–æ –ø–æ–ª–∏—Ç–∏–∫–µ visibility

#### DELETED
- –§–∞–π–ª –ø–æ–º–µ—á–µ–Ω –∫ —É–¥–∞–ª–µ–Ω–∏—é
- –ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –Ω–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –§–∏–∑–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é

### –ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞

#### –ö–ª—é—á–∏ —Ñ–∞–π–ª–æ–≤
–°—Ç—Ä—É–∫—Ç—É—Ä–∞: `{owner_type}/{owner_id}/{category}/{filename}`

–ü—Ä–∏–º–µ—Ä—ã:
```
user/550e8400-e29b-41d4-a716-446655440000/avatar/profile.jpg
event/123e4567-e89b-12d3-a456-426614174000/gallery/photo-001.jpg
organizer/987fcdeb-51d2-4c3a-8b45-123456789abc/logo/brand.png
system/defaults/avatars/user-placeholder.png
```

#### –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ MIME-—Ç–∏–ø–æ–≤ –ø–æ whitelist
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- SHA-256 checksum –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–ª—é—á–µ–π

#### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã —É–¥–∞–ª—è—é—Ç—Å—è –ø–æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ expires_at
- –ó–∞–≤–∏—Å—à–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ (>24 —á–∞—Å–∞ –≤ UPLOADING) –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è
- Proof –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏–º–µ—é—Ç TTL 90 –¥–Ω–µ–π

## API Endpoints

### Presigned URLs

#### `POST /api/v1/media/presign`
–ì–µ–Ω–µ—Ä–∞—Ü–∏—è presigned URL –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞

**Request:**
```json
{
  "contentType": "image/jpeg",
  "contentLength": 2048576,
  "ownerType": "user",
  "ownerId": "550e8400-e29b-41d4-a716-446655440000",
  "originalFilename": "avatar.jpg",
  "purpose": "avatar",
  "checksum": "a665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3"
}
```

**Response:**
```json
{
  "url": "https://minio.example.com/aquastream-media/user/550e8400-e29b-41d4-a716-446655440000/avatar/avatar.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&...",
  "key": "user/550e8400-e29b-41d4-a716-446655440000/avatar/avatar.jpg",
  "expires": "2025-08-20T15:30:00Z",
  "uploadSessionId": "123e4567-e89b-12d3-a456-426614174000",
  "method": "PUT",
  "instructions": "Upload file using PUT method with Content-Type: image/jpeg",
  "maxSizeBytes": 2048576,
  "allowedContentType": "image/jpeg"
}
```

### –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤

#### `GET /api/v1/media/download/{key}`
–ì–µ–Ω–µ—Ä–∞—Ü–∏—è presigned URL –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞

**Response:**
```json
{
  "url": "https://minio.example.com/aquastream-media/user/550e8400-e29b-41d4-a716-446655440000/avatar/avatar.jpg?X-Amz-Algorithm=AWS4-HMAC-SHA256&...",
  "key": "user/550e8400-e29b-41d4-a716-446655440000/avatar/avatar.jpg",
  "expires": "2025-08-20T16:00:00Z",
  "method": "GET"
}
```

#### `POST /api/v1/media/confirm/{key}`
–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞

**Request:**
```json
{
  "checksum": "a665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3"
}
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞–º–∏

#### `GET /api/v1/media/files`
–°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `ownerType` - —Ç–∏–ø –≤–ª–∞–¥–µ–ª—å—Ü–∞
- `ownerId` - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≤–ª–∞–¥–µ–ª—å—Ü–∞
- `status` - —Å—Ç–∞—Ç—É—Å —Ñ–∞–π–ª–∞
- `visibility` - –ø–æ–ª–∏—Ç–∏–∫–∞ –¥–æ—Å—Ç—É–ø–∞
- `page/size` - –ø–∞–≥–∏–Ω–∞—Ü–∏—è

#### `DELETE /api/v1/media/files/{key}`
–ü–æ–º–µ—Ç–∫–∞ —Ñ–∞–π–ª–∞ –∫ —É–¥–∞–ª–µ–Ω–∏—é

#### `GET /api/v1/media/files/{key}/info`
–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª–∞

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

```gradle
dependencies {
    implementation project(':backend-media:backend-media-api')
    implementation project(':backend-media:backend-media-service')
    implementation project(':backend-media:backend-media-db')
}
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```yaml
server:
  port: 8106

spring:
  datasource:
    url: jdbc:postgresql://localhost:5432/aquastream
    username: aquastream_user
    password: ${DB_PASSWORD}
  
  liquibase:
    change-log: classpath:migration/liquibase/master.xml
    default-schema: media

app:
  media:
    storage:
      minio:
        endpoint: http://localhost:9000
        access-key: minioadmin
        secret-key: minioadmin
        bucket: aquastream-media
      files:
        max-photo-mb: 5
        max-proof-mb: 5
        max-document-mb: 10
        max-video-mb: 50
      retention:
        proofs-days: 90
        temp-files-days: 1
        log-retention-days: 365
      presigned-url:
        upload-expiry: PT15M
        download-expiry: PT1H
```

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

#### –ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```java
@Autowired
private MediaService mediaService;

// 1. –ó–∞–ø—Ä–æ—Å presigned URL
PresignedUrlRequest request = PresignedUrlRequest.builder()
    .contentType("image/jpeg")
    .contentLength(1048576L)
    .ownerType("user")
    .ownerId(userId)
    .originalFilename("avatar.jpg")
    .purpose("avatar")
    .checksum("sha256-hash")
    .build();

PresignedUrlResponse response = mediaService.generatePresignedUrl(request);

// 2. –ö–ª–∏–µ–Ω—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–∞–π–ª –ø–æ presigned URL
// PUT request to response.getUrl()

// 3. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏
mediaService.confirmUpload(response.getKey(), "sha256-hash");
```

#### –ü–æ–ª—É—á–µ–Ω–∏–µ download URL

```java
// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è URL –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
String downloadUrl = mediaService.generateDownloadUrl(
    "user/550e8400-e29b-41d4-a716-446655440000/avatar/profile.jpg"
);
```

### –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞

#### 1. –ó–∞–ø—Ä–æ—Å presigned URL
```bash
curl -X POST /api/v1/media/presign \
  -H "Authorization: Bearer <jwt-token>" \
  -H "Content-Type: application/json" \
  -d '{
    "contentType": "image/jpeg",
    "contentLength": 1048576,
    "ownerType": "user", 
    "ownerId": "550e8400-e29b-41d4-a716-446655440000",
    "originalFilename": "photo.jpg",
    "purpose": "avatar"
  }'
```

#### 2. –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –≤ MinIO
```bash
curl -X PUT "${presigned_url}" \
  -H "Content-Type: image/jpeg" \
  -H "Content-Length: 1048576" \
  --data-binary @photo.jpg
```

#### 3. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏
```bash
curl -X POST /api/v1/media/confirm/user/550e8400-e29b-41d4-a716-446655440000/avatar/photo.jpg \
  -H "Authorization: Bearer <jwt-token>" \
  -H "Content-Type: application/json" \
  -d '{"checksum": "sha256-hash-here"}'
```

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –°—Ö–µ–º–∞: media

#### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
- **files** - –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Ä–µ–µ—Å—Ç—Ä –≤—Å–µ—Ö –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤
- **cleanup_log** - –õ–æ–≥ –æ–ø–µ—Ä–∞—Ü–∏–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏

#### –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **–û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã**: –ø–æ –∫–ª—é—á—É, –≤–ª–∞–¥–µ–ª—å—Ü—É, checksum
- **–°—Ç–∞—Ç—É—Å –∏ –¥–æ—Å—Ç—É–ø**: –ø–æ —Å—Ç–∞—Ç—É—Å—É, visibility
- **–í—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã**: –ø–æ –¥–∞—Ç–∞–º —Å–æ–∑–¥–∞–Ω–∏—è –∏ –∏—Å—Ç–µ—á–µ–Ω–∏—è
- **–°–æ—Å—Ç–∞–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã**: owner+status, owner+visibility

#### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å key
- –í–∞–ª–∏–¥–∞—Ü–∏—è checksum (SHA-256)
- –í–∞–ª–∏–¥–∞—Ü–∏—è MIME-—Ç–∏–ø–æ–≤
- size_bytes >= 0

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏

#### –¢—Ä–∏–≥–≥–µ—Ä—ã
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ updated_at
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–ª—é—á–µ–π —Ñ–∞–π–ª–æ–≤

#### –§—É–Ω–∫—Ü–∏–∏ –æ—á–∏—Å—Ç–∫–∏
```sql
-- –û—á–∏—Å—Ç–∫–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
SELECT media.cleanup_expired_files();

-- –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–∏—Å—à–∏—Ö –∑–∞–≥—Ä—É–∑–æ–∫
UPDATE media.files 
SET status = 'DELETED' 
WHERE status = 'UPLOADING' 
  AND created_at < NOW() - INTERVAL '24 hours';
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å MinIO

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ MinIO

#### Docker Compose
```yaml
services:
  minio:
    image: minio/minio:RELEASE.2024-06-13T22-53-53Z
    command: server /data --console-address ":9001"
    environment:
      MINIO_ROOT_USER: minioadmin
      MINIO_ROOT_PASSWORD: minioadmin
    ports:
      - "9000:9000"
      - "9001:9001"
    volumes:
      - minio_data:/data
```

#### –°–æ–∑–¥–∞–Ω–∏–µ bucket
```bash
mc alias set local http://localhost:9000 minioadmin minioadmin
mc mb local/aquastream-media
mc policy set public local/aquastream-media/public/
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è MinIO –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

```yaml
app:
  media:
    storage:
      minio:
        endpoint: http://localhost:9000
        access-key: minioadmin
        secret-key: minioadmin
        bucket: aquastream-media
        region: us-east-1
```

## –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞

#### Scheduled –∑–∞–¥–∞—á–∏
- **–ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 2:00**: –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- **–ö–∞–∂–¥—ã–π —á–∞—Å**: –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–∏—Å—à–∏—Ö –∑–∞–≥—Ä—É–∑–æ–∫ (>24 —á–∞—Å–∞ –≤ UPLOADING)
- **–ï–∂–µ–º–µ—Å—è—á–Ω–æ**: –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤ (>365 –¥–Ω–µ–π)
- **–ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç**: Health check —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å MinIO

#### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è scheduler
```java
@Component
@ConditionalOnProperty(name = "app.scheduling.enabled", havingValue = "true")
public class FileCleanupScheduler {
    
    @Scheduled(cron = "0 0 2 * * *") // –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 2:00
    public void cleanupExpiredFiles() {
        // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
    }
    
    @Scheduled(cron = "0 0 * * * *") // –ö–∞–∂–¥—ã–π —á–∞—Å
    public void cleanupStuckUploads() {
        // –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–∏—Å—à–∏—Ö –∑–∞–≥—Ä—É–∑–æ–∫
    }
}
```

## –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### –†–∞–∑–º–µ—Ä—ã —Ñ–∞–π–ª–æ–≤

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä |
|-----------|-------------------|
| –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ | 5 –ú–ë |
| –î–æ–∫—É–º–µ–Ω—Ç—ã-–ø—Ä—É—Ñ—ã | 5 –ú–ë |
| –î–æ–∫—É–º–µ–Ω—Ç—ã | 10 –ú–ë |
| –í–∏–¥–µ–æ | 50 –ú–ë |

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∏–ø—ã —Ñ–∞–π–ª–æ–≤

#### –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- image/jpeg
- image/png
- image/webp
- image/gif

#### –î–æ–∫—É–º–µ–Ω—Ç—ã
- application/pdf
- text/plain
- application/msword
- application/vnd.openxmlformats-officedocument.wordprocessingml.document

#### –í–∏–¥–µ–æ
- video/mp4
- video/webm
- video/quicktime

### –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ presigned URLs

#### Upload URLs
- **–í—Ä–µ–º—è –∂–∏–∑–Ω–∏**: 15 –º–∏–Ω—É—Ç
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –∫–ª–∏–µ–Ω—Ç–∞–º–∏
- **–ú–µ—Ç–æ–¥**: PUT
- **–í–∞–ª–∏–¥–∞—Ü–∏—è**: Content-Type –∏ —Ä–∞–∑–º–µ—Ä–∞

#### Download URLs  
- **–í—Ä–µ–º—è –∂–∏–∑–Ω–∏**: 1 —á–∞—Å
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
- **–ú–µ—Ç–æ–¥**: GET
- **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è**: –¢–æ–ª—å–∫–æ —Ñ–∞–π–ª—ã –≤ —Å—Ç–∞—Ç—É—Å–µ READY

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ HTTP –∫–æ–¥—ã

- **400 Bad Request** - –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞
- **401 Unauthorized** - –¢—Ä–µ–±—É–µ—Ç—Å—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- **403 Forbidden** - –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
- **404 Not Found** - –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω
- **413 Payload Too Large** - –ü—Ä–µ–≤—ã—à–µ–Ω –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
- **415 Unsupported Media Type** - –ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ç–∏–ø —Ñ–∞–π–ª–∞
- **503 Service Unavailable** - –ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

### –§–æ—Ä–º–∞—Ç –æ—à–∏–±–æ–∫ (RFC 7807)

#### 413 Payload Too Large
```json
{
  "type": "https://api.aquastream.org/errors/file-too-large",
  "title": "–ü—Ä–µ–≤—ã—à–µ–Ω –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞",
  "status": 413,
  "detail": "–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ 10485760 –±–∞–π—Ç –ø—Ä–µ–≤—ã—à–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –¥–æ–ø—É—Å—Ç–∏–º—ã–π 5242880 –±–∞–π—Ç –¥–ª—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π",
  "instance": "/api/v1/media/presign",
  "timestamp": "2025-08-20T10:30:00Z",
  "correlationId": "req-abc123"
}
```

#### 415 Unsupported Media Type
```json
{
  "type": "https://api.aquastream.org/errors/unsupported-media-type",
  "title": "–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ç–∏–ø —Ñ–∞–π–ª–∞",
  "status": 415,
  "detail": "–¢–∏–ø —Ñ–∞–π–ª–∞ application/x-executable –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è",
  "instance": "/api/v1/media/presign",
  "timestamp": "2025-08-20T10:30:00Z",
  "correlationId": "req-abc123"
}
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Health Check

```bash
GET /actuator/health
```

### –ú–µ—Ç—Ä–∏–∫–∏

```bash
GET /actuator/metrics
```

### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤ –ø–æ —Ç–∏–ø–∞–º –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–≤ —Ñ–∞–π–ª–æ–≤
- –£—Å–ø–µ—à–Ω–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–æ–∫ (–ø–æ —Å—Ç–∞—Ç—É—Å–∞–º)
- –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—á–∏—Å—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤
- –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å MinIO storage

### Prometheus –º–µ—Ç—Ä–∏–∫–∏

- `media_files_total` - –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤
- `media_storage_size_bytes` - –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–µ –º–µ—Å—Ç–æ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
- `media_upload_duration_seconds` - –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
- `media_cleanup_files_total` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—á–∏—â–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- `media_storage_health` - –∑–¥–æ—Ä–æ–≤—å–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å MinIO

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Unit —Ç–µ—Å—Ç—ã

```bash
./gradlew backend-media:backend-media-service:test
```

### Integration —Ç–µ—Å—Ç—ã

```bash
./gradlew backend-media:backend-media-api:test
```

### –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

–ú–æ–¥—É–ª—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ TestContainers —Å MinIO –∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö H2.

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- –°–æ—Å—Ç–∞–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- Partial –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ CompletableFuture
- Connection pooling –¥–ª—è MinIO –∫–ª–∏–µ–Ω—Ç–∞

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- Spring Cache –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- CDN –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- HTTP cache headers –Ω–∞ –æ—Å–Ω–æ–≤–µ updated_at

### –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- Stateless —Å–µ—Ä–≤–∏—Å
- –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- –®–∞—Ä–¥–∏–Ω–≥ —Ñ–∞–π–ª–æ–≤ –ø–æ owner_type
- –†–µ–ø–ª–∏–∫–∞—Ü–∏—è MinIO –¥–ª—è –≤—ã—Å–æ–∫–æ–π –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- JWT —Ç–æ–∫–µ–Ω—ã —á–µ—Ä–µ–∑ Gateway
- Role-based –¥–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª–∞–º
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–∞–º–∏

### –í–∞–ª–∏–¥–∞—Ü–∏—è
- Whitelist MIME-—Ç–∏–ø–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ —Ñ–∞–π–ª–æ–≤
- SHA-256 checksum –≤–∞–ª–∏–¥–∞—Ü–∏—è
- –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –∏–º–µ–Ω —Ñ–∞–π–ª–æ–≤

### –ó–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö
- –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –≤ MinIO
- Audit trail –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å—é

## –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### Docker

```dockerfile
FROM openjdk:21-jre-slim
COPY backend-media-api/build/libs/*.jar app.jar
EXPOSE 8106
ENTRYPOINT ["java", "-jar", "/app.jar"]
```

### Environment –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

```bash
SPRING_PROFILES_ACTIVE=prod
DB_HOST=postgres
DB_PASSWORD=secure_password
MINIO_ENDPOINT=https://minio.example.com
MINIO_ACCESS_KEY=access_key
MINIO_SECRET_KEY=secret_key
MINIO_BUCKET=aquastream-media
```

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### –û—Å–Ω–æ–≤–Ω—ã–µ
- Spring Boot 3.x
- Spring Data JPA
- PostgreSQL 15+
- Liquibase
- MinIO Java Client 8.x

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ
- Redis (–∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ)
- Micrometer (–º–µ—Ç—Ä–∏–∫–∏)
- TestContainers (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

## –õ–∏—Ü–µ–Ω–∑–∏—è

–ß–∞—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∞ AquaStream. –°–º. LICENSE –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.
