# Crew Service — Бизнес-логика

## Обзор

Crew Service управляет группами участников: экипажи, палатки, столы, транспорт.

## Ответственности
- Ведение групп размещения: CREW, TENT, TABLE, BUS
- Управление вместимостью и актуальными назначениями мест
- Учёт предпочтений/ограничений участников при распределении

## Алгоритм распределения
- Жёсткие ограничения: вместимость, несовместимые участники
- Мягкие предпочтения: «хочу вместе с», «избегать с» (см. `team_preferences`)
- Балансировка заполнения групп, минимизация конфликтов
- Пере‑распределение при отменах/изменении брони

## Интеграции
- Event: валидация `event_id`, синхронизация статусов брони
- Notification: оповещения об изменении назначений

## Типы групп

```java
enum CrewType {
    CREW,     // Экипаж байдарки
    TENT,     // Палатка
    TABLE,    // Стол на банкете
    BUS       // Место в автобусе
}
```

## База данных (схема `crew`)

```sql
crews (
    id, 
    event_id,          -- Связь с событием
    name,              -- Название группы
    type,              -- CREW | TENT | TABLE | BUS
    capacity           -- Вместимость
)

crew_assignments (
    id,
    crew_id,
    user_id,
    booking_id,        -- Ссылка на бронь
    seat_number,       -- Номер места
    assigned_by        -- Кто назначил
)

team_preferences (
    user_id,
    event_id,
    prefers_with_user_ids[],  -- Хочу вместе с...
    avoids_user_ids[]         -- Избегать...
)
```

## Безопасность

- ✅ Проверка capacity при назначении
- ✅ Атомарность пакетных операций
- ✅ Аудит изменений назначений

## См. также

- [Crew API](api.md)
- [Event Service](../event/business-logic.md) - связь с бронированиями
