# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Backend-Event

–î–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø–æ–¥—Ö–æ–¥—ã –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é, —Ç–∏–ø—ã —Ç–µ—Å—Ç–æ–≤, –ø—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞ `backend-event`.

## üìë –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [üß™ –¢–∏–ø—ã —Ç–µ—Å—Ç–æ–≤ –∏ –ø–æ–¥—Ö–æ–¥—ã](#-—Ç–∏–ø—ã-—Ç–µ—Å—Ç–æ–≤-–∏-–ø–æ–¥—Ö–æ–¥—ã)
   - [–ú–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã](#–º–æ–¥—É–ª—å–Ω—ã–µ-—Ç–µ—Å—Ç—ã)
   - [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ-—Ç–µ—Å—Ç—ã)
   - [E2E —Ç–µ—Å—Ç—ã](#e2e-—Ç–µ—Å—Ç—ã)
   - [–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–Ω—ã–µ —Ç–µ—Å—Ç—ã](#–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–Ω—ã–µ-—Ç–µ—Å—Ç—ã)
2. [üõ†Ô∏è –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –º–æ–∫–∏](#Ô∏è-—Ç–µ—Å—Ç–æ–≤—ã–µ-–¥–∞–Ω–Ω—ã–µ-–∏-–º–æ–∫–∏)
   - [–¢–µ—Å—Ç–æ–≤—ã–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö](#—Ç–µ—Å—Ç–æ–≤—ã–µ-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö)
   - [–ú–æ–∫–∏ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤](#–º–æ–∫–∏-–≤–Ω–µ—à–Ω–∏—Ö-—Å–µ—Ä–≤–∏—Å–æ–≤)
   - [–¢–µ—Å—Ç–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏](#—Ç–µ—Å—Ç–æ–≤—ã–µ-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)
3. [üìä –ü—Ä–∏–º–µ—Ä—ã JSON –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è](#-–ø—Ä–∏–º–µ—Ä—ã-json-–¥–ª—è-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
   - [–°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è](#—Å–æ–∑–¥–∞–Ω–∏–µ-—Å–æ–±—ã—Ç–∏—è)
   - [–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ](#–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)
   - [–ü–ª–∞—Ç–µ–∂–∏](#–ø–ª–∞—Ç–µ–∂–∏)
   - [–û—Ç–∑—ã–≤—ã](#–æ—Ç–∑—ã–≤—ã)
4. [üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é](#-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏-–ø–æ-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é)
   - [–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤](#–∑–∞–ø—É—Å–∫-—Ç–µ—Å—Ç–æ–≤)
   - [–û—Ç–ª–∞–¥–∫–∞ —Ç–µ—Å—Ç–æ–≤](#–æ—Ç–ª–∞–¥–∫–∞-—Ç–µ—Å—Ç–æ–≤)
   - [CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è](#cicd-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)
   - [–ê–Ω–∞–ª–∏–∑ –ø–æ–∫—Ä—ã—Ç–∏—è](#–∞–Ω–∞–ª–∏–∑-–ø–æ–∫—Ä—ã—Ç–∏—è)

## üß™ –¢–∏–ø—ã —Ç–µ—Å—Ç–æ–≤ –∏ –ø–æ–¥—Ö–æ–¥—ã

### –ú–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã

–ú–æ–¥—É–ª—å–Ω—ã–µ (unit) —Ç–µ—Å—Ç—ã —Ñ–æ–∫—É—Å–∏—Ä—É—é—Ç—Å—è –Ω–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤ –∏–∑–æ–ª—è—Ü–∏–∏. –î–ª—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞ `backend-event` –º–æ–¥—É–ª—å–Ω–æ–º—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –ø–æ–¥–ª–µ–∂–∞—Ç:

1. **–°–µ—Ä–≤–∏—Å—ã** ‚Äî –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞, –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ –∑–∞–ø—Ä–æ—Å–æ–≤ CQRS
2. **–£—Ç–∏–ª–∏—Ç–Ω—ã–µ –∫–ª–∞—Å—Å—ã** ‚Äî –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
3. **–ú–∞–ø–ø–∏–Ω–≥** ‚Äî –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –º–µ–∂–¥—É —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏ –¥–∞–Ω–Ω—ã—Ö

#### –ü—Ä–∏–º–µ—Ä –º–æ–¥—É–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞

```java
@ExtendWith(MockitoExtension.class)
class EventServiceTest {
    @Mock
    private EventRepository eventRepository;
    
    @Mock
    private NotificationService notificationService;
    
    @InjectMocks
    private EventServiceImpl eventService;
    
    @Test
    void shouldCancelEvent() {
        // Given
        UUID eventId = UUID.randomUUID();
        Event event = new Event();
        event.setId(eventId);
        event.setTitle("Test Event");
        event.setStatus(EventStatus.PUBLISHED);
        event.setStartDate(LocalDateTime.now().plusDays(1));
        
        given(eventRepository.findById(eventId)).willReturn(Optional.of(event));
        
        // When
        eventService.cancelEvent(eventId, "Test reason");
        
        // Then
        verify(eventRepository).save(argThat(e -> e.getStatus() == EventStatus.CANCELED));
        verify(notificationService).notifyEventCancellation(eq(event), eq("Test reason"));
    }
    
    @Test
    void shouldThrowExceptionWhenCancelingNonExistentEvent() {
        // Given
        UUID eventId = UUID.randomUUID();
        given(eventRepository.findById(eventId)).willReturn(Optional.empty());
        
        // When, Then
        assertThrows(EntityNotFoundException.class, 
                     () -> eventService.cancelEvent(eventId, "Test reason"));
    }
}
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã, –≤–∫–ª—é—á–∞—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –∏ –≤–Ω–µ—à–Ω–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏. –í –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è:

1. **–†–µ–ø–æ–∑–∏—Ç–æ—Ä–Ω—ã–µ —Ç–µ—Å—Ç—ã** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
2. **API —Ç–µ—Å—Ç—ã** ‚Äî —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ REST –∏ gRPC –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –¥—Ä—É–≥–∏–º–∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º–∏

#### –ü—Ä–∏–º–µ—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ –¥–ª—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è —Å TestContainers

```java
@DataJpaTest
@AutoConfigureTestDatabase(replace = AutoConfigureTestDatabase.Replace.NONE)
@Testcontainers
class EventRepositoryIntegrationTest {
    @Container
    static PostgreSQLContainer<?> postgres = new PostgreSQLContainer<>("postgres:15")
        .withDatabaseName("test_db")
        .withUsername("test_user")
        .withPassword("test_password");

    @DynamicPropertySource
    static void postgresProperties(DynamicPropertyRegistry registry) {
        registry.add("spring.datasource.url", postgres::getJdbcUrl);
        registry.add("spring.datasource.username", postgres::getUsername);
        registry.add("spring.datasource.password", postgres::getPassword);
    }
    
    @Autowired
    private EventRepository eventRepository;
    
    @Test
    void shouldFindUpcomingEvents() {
        // Given
        EventEntity pastEvent = createTestEvent("Past Event", LocalDateTime.now().minusDays(2));
        EventEntity todayEvent = createTestEvent("Today Event", LocalDateTime.now());
        EventEntity futureEvent = createTestEvent("Future Event", LocalDateTime.now().plusDays(2));
        
        eventRepository.saveAll(List.of(pastEvent, todayEvent, futureEvent));
        
        // When
        List<EventEntity> upcomingEvents = eventRepository.findUpcomingEvents(
            LocalDateTime.now(), PageRequest.of(0, 10));
        
        // Then
        assertThat(upcomingEvents).hasSize(2);
        assertThat(upcomingEvents.stream().map(EventEntity::getTitle))
            .containsExactlyInAnyOrder("Today Event", "Future Event");
    }
    
    private EventEntity createTestEvent(String title, LocalDateTime startDate) {
        EventEntity event = new EventEntity();
        event.setId(UUID.randomUUID());
        event.setTitle(title);
        event.setDescription("Test Description");
        event.setStartDate(startDate);
        event.setEndDate(startDate.plusHours(2));
        event.setStatus(EventStatus.PUBLISHED.name());
        event.setCreatedAt(LocalDateTime.now());
        event.setUpdatedAt(LocalDateTime.now());
        return event;
    }
}
```

#### –ü—Ä–∏–º–µ—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ –¥–ª—è REST API

```java
@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
@AutoConfigureMockMvc
class EventControllerIntegrationTest {
    @Autowired
    private MockMvc mockMvc;
    
    @Autowired
    private ObjectMapper objectMapper;
    
    @MockBean
    private EventService eventService;
    
    @Test
    void shouldReturnEventWhenGetById() throws Exception {
        // Given
        UUID eventId = UUID.randomUUID();
        EventDto eventDto = new EventDto();
        eventDto.setId(eventId);
        eventDto.setTitle("Test Event");
        eventDto.setDescription("Test Description");
        eventDto.setStartDate(LocalDateTime.now().plusDays(1));
        
        given(eventService.getEvent(eq(eventId), anyBoolean())).willReturn(eventDto);
        
        // When, Then
        mockMvc.perform(get("/api/events/{id}", eventId)
                .accept(MediaType.APPLICATION_JSON))
                .andExpect(status().isOk())
                .andExpect(jsonPath("$.id").value(eventId.toString()))
                .andExpect(jsonPath("$.title").value("Test Event"));
    }
    
    @Test
    void shouldCreateEventSuccessfully() throws Exception {
        // Given
        UUID eventId = UUID.randomUUID();
        CreateEventRequest request = new CreateEventRequest();
        request.setTitle("New Event");
        request.setDescription("New Description");
        request.setStartDate(LocalDateTime.now().plusDays(1).toString());
        
        given(eventService.createEvent(any(CreateEventRequest.class)))
            .willReturn(eventId);
        
        // When, Then
        mockMvc.perform(post("/api/events")
                .contentType(MediaType.APPLICATION_JSON)
                .content(objectMapper.writeValueAsString(request)))
                .andExpect(status().isCreated())
                .andExpect(header().string("Location", containsString("/api/events/" + eventId)));
    }
}
```

### E2E —Ç–µ—Å—Ç—ã

End-to-end (E2E) —Ç–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç –ø–æ–ª–Ω—ã–π –ø—É—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è —á–µ—Ä–µ–∑ –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã. –î–ª—è `backend-event` –æ—Å–Ω–æ–≤–Ω—ã–µ E2E —Å—Ü–µ–Ω–∞—Ä–∏–∏ –≤–∫–ª—é—á–∞—é—Ç:

1. **–°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è -> –ü—É–±–ª–∏–∫–∞—Ü–∏—è -> –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ -> –û–ø–ª–∞—Ç–∞ -> –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ**
2. **–°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è -> –û—Ç–º–µ–Ω–∞ -> –í–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤**
3. **–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ –æ–ø–ª–∞—Ç—ã -> –ò—Å—Ç–µ—á–µ–Ω–∏–µ —Å—Ä–æ–∫–∞ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏—è**

#### –ü—Ä–∏–º–µ—Ä E2E —Ç–µ—Å—Ç–∞ —Å WireMock –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

```java
@SpringBootTest
@Testcontainers
@AutoConfigureWireMock(port = 0)
class EventBookingE2ETest {
    @Container
    static PostgreSQLContainer<?> postgres = new PostgreSQLContainer<>("postgres:15")
        .withDatabaseName("test_db")
        .withUsername("test_user")
        .withPassword("test_password");
        
    @Container
    static GenericContainer<?> redis = new GenericContainer<>("redis:7-alpine")
        .withExposedPorts(6379);
    
    @DynamicPropertySource
    static void configureProperties(DynamicPropertyRegistry registry) {
        registry.add("spring.datasource.url", postgres::getJdbcUrl);
        registry.add("spring.datasource.username", postgres::getUsername);
        registry.add("spring.datasource.password", postgres::getPassword);
        registry.add("spring.redis.host", redis::getHost);
        registry.add("spring.redis.port", redis::getFirstMappedPort);
        registry.add("payment-service.url", () -> "http://localhost:" + wireMockServer.port());
        registry.add("notification-service.url", () -> "http://localhost:" + wireMockServer.port());
    }
    
    @Autowired
    private EventService eventService;
    
    @Autowired
    private BookingService bookingService;
    
    @Autowired
    private PaymentService paymentService;
    
    @Test
    void fullBookingFlow() {
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–∫–∞ –¥–ª—è –ø–ª–∞—Ç–µ–∂–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
        stubFor(post(urlEqualTo("/api/payments"))
            .willReturn(aResponse()
                .withStatus(200)
                .withHeader("Content-Type", "application/json")
                .withBody("{\"paymentId\":\"pay123\",\"status\":\"COMPLETED\"}")));
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–∫–∞ –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        stubFor(post(urlEqualTo("/api/notifications"))
            .willReturn(aResponse()
                .withStatus(200)));
        
        // 1. –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è
        CreateEventRequest eventRequest = prepareEventRequest();
        UUID eventId = eventService.createEvent(eventRequest);
        
        // 2. –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏—è
        eventService.publishEvent(eventId);
        
        // 3. –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
        BookingRequest bookingRequest = prepareBookingRequest(eventId);
        UUID bookingId = bookingService.createBooking(bookingRequest);
        
        // 4. –û–ø–ª–∞—Ç–∞
        PaymentRequest paymentRequest = preparePaymentRequest(bookingId);
        PaymentResult paymentResult = paymentService.processPayment(paymentRequest);
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∏
        assertThat(paymentResult.isSuccessful()).isTrue();
        
        Booking booking = bookingService.getBooking(bookingId);
        assertThat(booking.getStatus()).isEqualTo(BookingStatus.CONFIRMED);
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–∑–æ–≤–∞ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
        verify(postRequestedFor(urlEqualTo("/api/payments")));
        verify(postRequestedFor(urlEqualTo("/api/notifications")));
    }
    
    private CreateEventRequest prepareEventRequest() {
        // –ö–æ–¥ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è
    }
    
    private BookingRequest prepareBookingRequest(UUID eventId) {
        // –ö–æ–¥ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
    }
    
    private PaymentRequest preparePaymentRequest(UUID bookingId) {
        // –ö–æ–¥ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –æ–ø–ª–∞—Ç—É
    }
}
```

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–Ω—ã–µ —Ç–µ—Å—Ç—ã

–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π. –î–ª—è `backend-event` –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è:

1. **–¢–µ—Å—Ç—ã –Ω–∞–≥—Ä—É–∑–∫–∏** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã –ø—Ä–∏ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–º —É–≤–µ–ª–∏—á–µ–Ω–∏–∏ –Ω–∞–≥—Ä—É–∑–∫–∏
2. **–°—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç—ã** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã –ø—Ä–∏ —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ
3. **–í—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã –ø—Ä–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏

#### –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ JMeter –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API

```xml
<?xml version="1.0" encoding="UTF-8"?>
<jmeterTestPlan version="1.2" properties="5.0">
  <hashTree>
    <TestPlan guiclass="TestPlanGui" testclass="TestPlan" testname="Event Service Load Test">
      <elementProp name="TestPlan.user_defined_variables" elementType="Arguments">
        <collectionProp name="Arguments.arguments"/>
      </elementProp>
    </TestPlan>
    <hashTree>
      <ThreadGroup guiclass="ThreadGroupGui" testclass="ThreadGroup" testname="List Events">
        <intProp name="ThreadGroup.num_threads">100</intProp>
        <intProp name="ThreadGroup.ramp_time">30</intProp>
        <boolProp name="ThreadGroup.same_user_on_next_iteration">true</boolProp>
        <stringProp name="ThreadGroup.duration">300</stringProp>
        <stringProp name="ThreadGroup.delay"></stringProp>
      </ThreadGroup>
      <hashTree>
        <HTTPSamplerProxy guiclass="HttpTestSampleGui" testclass="HTTPSamplerProxy">
          <stringProp name="HTTPSampler.domain">api.test.aquastream.com</stringProp>
          <stringProp name="HTTPSampler.port">443</stringProp>
          <stringProp name="HTTPSampler.protocol">https</stringProp>
          <stringProp name="HTTPSampler.path">/api/events</stringProp>
          <stringProp name="HTTPSampler.method">GET</stringProp>
          <boolProp name="HTTPSampler.use_keepalive">true</boolProp>
        </HTTPSamplerProxy>
        <hashTree>
          <HeaderManager guiclass="HeaderPanel" testclass="HeaderManager" testname="HTTP Headers">
            <collectionProp name="HeaderManager.headers">
              <elementProp name="" elementType="Header">
                <stringProp name="Header.name">Content-Type</stringProp>
                <stringProp name="Header.value">application/json</stringProp>
              </elementProp>
              <elementProp name="" elementType="Header">
                <stringProp name="Header.name">Authorization</stringProp>
                <stringProp name="Header.value">Bearer ${__P(auth_token)}</stringProp>
              </elementProp>
            </collectionProp>
          </HeaderManager>
          <hashTree/>
          <ResponseAssertion guiclass="AssertionGui" testclass="ResponseAssertion">
            <collectionProp name="Asserion.test_strings">
              <stringProp name="49586">200</stringProp>
            </collectionProp>
            <stringProp name="Assertion.test_field">Assertion.response_code</stringProp>
            <stringProp name="Assertion.custom_message"></stringProp>
          </ResponseAssertion>
          <hashTree/>
        </hashTree>
      </hashTree>
      <!-- –î—Ä—É–≥–∏–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ -->
    </hashTree>
  </hashTree>
</jmeterTestPlan>
```

## üõ†Ô∏è –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –º–æ–∫–∏

### –¢–µ—Å—Ç–æ–≤—ã–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ –ø–æ–¥—Ö–æ–¥—ã –∫ —Ä–∞–±–æ—Ç–µ —Å –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö:

1. **–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ë–î** (H2) ‚Äî –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ—Å—Ç—ã—Ö —Ç–µ—Å—Ç–æ–≤
2. **TestContainers** ‚Äî –¥–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å PostgreSQL –∏ Redis
3. **–¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ö–µ–º—ã** ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å—Ö–µ–º—ã –≤ –±–æ–µ–≤–æ–π –ë–î –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ TestContainers –¥–ª—è PostgreSQL –∏ Redis

```java
@TestConfiguration
public class TestDatabaseConfig {
    @Bean
    @Primary
    public DataSource dataSource() {
        PostgreSQLContainer<?> postgres = new PostgreSQLContainer<>("postgres:15")
            .withDatabaseName("test_db")
            .withUsername("test_user")
            .withPassword("test_password")
            .withInitScript("schema.sql");
        
        postgres.start();
        
        return DataSourceBuilder.create()
            .url(postgres.getJdbcUrl())
            .username(postgres.getUsername())
            .password(postgres.getPassword())
            .build();
    }
    
    @Bean
    @Primary
    public RedisConnectionFactory redisConnectionFactory() {
        GenericContainer<?> redis = new GenericContainer<>("redis:7-alpine")
            .withExposedPorts(6379);
        
        redis.start();
        
        RedisStandaloneConfiguration config = new RedisStandaloneConfiguration();
        config.setHostName(redis.getHost());
        config.setPort(redis.getFirstMappedPort());
        
        return new LettuceConnectionFactory(config);
    }
}
```

### –ú–æ–∫–∏ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

–î–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤ –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–æ–¥—Ö–æ–¥—ã:

1. **Mockito** ‚Äî –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤ –º–æ–¥—É–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö
2. **WireMock** ‚Äî –¥–ª—è –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è –≤–Ω–µ—à–Ω–∏—Ö HTTP-—Å–µ—Ä–≤–∏—Å–æ–≤ –≤ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö
3. **Testcontainers** ‚Äî –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤

#### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è WireMock –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ –≤–Ω–µ—à–Ω–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞

```java
@SpringBootTest
@AutoConfigureWireMock(port = 0)
class ExternalServiceTest {
    @Value("${wiremock.server.port}")
    private int wireMockPort;
    
    @BeforeEach
    void setUp() {
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ URL —Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è WireMock
        System.setProperty("payment.service.url", "http://localhost:" + wireMockPort);
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≥–ª—É—à–∫–∏ –¥–ª—è –≤–Ω–µ—à–Ω–µ–≥–æ API
        stubFor(post(urlEqualTo("/api/payments"))
            .withHeader("Content-Type", containing("application/json"))
            .withRequestBody(matchingJsonPath("$.amount"))
            .willReturn(aResponse()
                .withStatus(200)
                .withHeader("Content-Type", "application/json")
                .withBody("{"
                    + "\"paymentId\": \"p12345\","
                    + "\"status\": \"COMPLETED\","
                    + "\"transactionId\": \"t67890\""
                    + "}")));
    }
    
    @Test
    void shouldProcessPaymentSuccessfully() {
        // Given
        PaymentRequest request = new PaymentRequest();
        request.setAmount(new BigDecimal("100.00"));
        request.setBookingId(UUID.randomUUID());
        
        // When
        PaymentResponse response = paymentService.processPayment(request);
        
        // Then
        assertThat(response.getStatus()).isEqualTo(PaymentStatus.COMPLETED);
        assertThat(response.getPaymentId()).isEqualTo("p12345");
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–≥–æ, —á—Ç–æ –∑–∞–ø—Ä–æ—Å –±—ã–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω
        verify(postRequestedFor(urlEqualTo("/api/payments"))
            .withRequestBody(matchingJsonPath("$.amount", equalTo("100.00"))));
    }
}
```

### –¢–µ—Å—Ç–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:

| –†–æ–ª—å | –õ–æ–≥–∏–Ω | –ü–∞—Ä–æ–ª—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-------|--------|----------|
| –ì–æ—Å—Ç—å | - | - | –ù–µ–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å |
| –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å | `user@test.com` | `test123` | –û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –±–∞–∑–æ–≤—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏ |
| –û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä | `organizer@test.com` | `test123` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –ø—Ä–∞–≤–∞–º–∏ —Å–æ–∑–¥–∞–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏—è–º–∏ |
| –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä | `admin@test.com` | `test123` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –ø–æ–ª–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ |

#### –ü—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ Spring Security 

```java
@TestConfiguration
@EnableWebSecurity
public class TestSecurityConfig {
    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        http
            .csrf().disable()
            .authorizeRequests()
                .antMatchers("/api/events").permitAll()
                .antMatchers("/api/bookings/**").hasRole("USER")
                .antMatchers("/api/admin/**").hasRole("ADMIN")
                .anyRequest().authenticated()
            .and()
            .httpBasic();
        
        return http.build();
    }
    
    @Bean
    public InMemoryUserDetailsManager userDetailsService() {
        UserDetails user = User.builder()
            .username("user@test.com")
            .password("{noop}test123")
            .roles("USER")
            .build();
            
        UserDetails organizer = User.builder()
            .username("organizer@test.com")
            .password("{noop}test123")
            .roles("USER", "ORGANIZER")
            .build();
            
        UserDetails admin = User.builder()
            .username("admin@test.com")
            .password("{noop}test123")
            .roles("USER", "ORGANIZER", "ADMIN")
            .build();
            
        return new InMemoryUserDetailsManager(user, organizer, admin);
    }
}
```

## üìä –ü—Ä–∏–º–µ—Ä—ã JSON –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è

#### –ó–∞–ø—Ä–æ—Å —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Å–æ–±—ã—Ç–∏—è

```json
{
  "title": "–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ",
  "description": "–û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ API",
  "start_date": "2023-12-15T10:00:00Z",
  "end_date": "2023-12-15T15:00:00Z",
  "location": "–ú–æ—Å–∫–≤–∞, —É–ª. –¢–µ—Å—Ç–æ–≤–∞—è, 123",
  "capacity": 50,
  "category_id": "9a1b2c3d-4e5f-6a7b-8c9d-0e1f2a3b4c5d",
  "price_options": [
    {
      "name": "–°—Ç–∞–Ω–¥–∞—Ä—Ç",
      "price": 1500,
      "available_quantity": 40
    },
    {
      "name": "VIP",
      "price": 3000,
      "available_quantity": 10
    }
  ],
  "organizer_id": "5e6f7a8b-9c0d-1e2f-3a4b-5c6d7e8f9a0b"
}
```

#### –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è

```json
{
  "id": "1a2b3c4d-5e6f-7a8b-9c0d-1e2f3a4b5c6d",
  "title": "–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ",
  "status": "DRAFT",
  "created_at": "2023-10-05T14:23:11Z"
}
```

### –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –ó–∞–ø—Ä–æ—Å —Å–æ–∑–¥–∞–Ω–∏—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

```json
{
  "event_id": "1a2b3c4d-5e6f-7a8b-9c0d-1e2f3a4b5c6d",
  "price_option_id": "2b3c4d5e-6f7a-8b9c-0d1e-2f3a4b5c6d7e",
  "quantity": 2,
  "user_id": "7e8f9a0b-1c2d-3e4f-5a6b-7c8d9e0f1a2b",
  "promo_code": "WELCOME2023"
}
```

#### –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

```json
{
  "id": "3c4d5e6f-7a8b-9c0d-1e2f-3a4b5c6d7e8f",
  "event": {
    "id": "1a2b3c4d-5e6f-7a8b-9c0d-1e2f3a4b5c6d",
    "title": "–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ"
  },
  "status": "PENDING_PAYMENT",
  "total_amount": 2700.00,
  "deadline": "2023-10-05T16:23:11Z",
  "booking_code": "BKG12345678"
}
```

### –ü–ª–∞—Ç–µ–∂–∏

#### –ó–∞–ø—Ä–æ—Å –∏–Ω–∏—Ü–∏–∞—Ü–∏–∏ –ø–ª–∞—Ç–µ–∂–∞

```json
{
  "booking_id": "3c4d5e6f-7a8b-9c0d-1e2f-3a4b5c6d7e8f",
  "payment_method": "CARD",
  "amount": 2700.00,
  "currency": "RUB",
  "return_url": "https://aquastream.com/payment/success",
  "cancel_url": "https://aquastream.com/payment/cancel"
}
```

#### –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ –∏–Ω–∏—Ü–∏–∞—Ü–∏—é –ø–ª–∞—Ç–µ–∂–∞

```json
{
  "payment_id": "4d5e6f7a-8b9c-0d1e-2f3a-4b5c6d7e8f9a",
  "status": "INITIATED",
  "redirect_url": "https://payment-provider.com/pay/12345",
  "amount": 2700.00,
  "currency": "RUB",
  "expires_at": "2023-10-05T16:23:11Z"
}
```

#### Callback –æ—Ç –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã

```json
{
  "payment_id": "4d5e6f7a-8b9c-0d1e-2f3a-4b5c6d7e8f9a",
  "status": "COMPLETED",
  "transaction_id": "tx_123456789",
  "amount": 2700.00,
  "currency": "RUB",
  "timestamp": "2023-10-05T14:30:45Z"
}
```

### –û—Ç–∑—ã–≤—ã

#### –ó–∞–ø—Ä–æ—Å —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç–∑—ã–≤–∞

```json
{
  "event_id": "1a2b3c4d-5e6f-7a8b-9c0d-1e2f3a4b5c6d",
  "user_id": "7e8f9a0b-1c2d-3e4f-5a6b-7c8d9e0f1a2b",
  "rating": 5,
  "content": "–û—Ç–ª–∏—á–Ω–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ! –í—Å–µ –±—ã–ª–æ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–æ –Ω–∞ –≤—ã—Å—à–µ–º —É—Ä–æ–≤–Ω–µ."
}
```

#### –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –æ—Ç–∑—ã–≤–∞

```json
{
  "id": "5a6b7c8d-9e0f-1a2b-3c4d-5e6f7a8b9c0d",
  "event_id": "1a2b3c4d-5e6f-7a8b-9c0d-1e2f3a4b5c6d",
  "user_id": "7e8f9a0b-1c2d-3e4f-5a6b-7c8d9e0f1a2b",
  "rating": 5,
  "content": "–û—Ç–ª–∏—á–Ω–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ! –í—Å–µ –±—ã–ª–æ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–æ –Ω–∞ –≤—ã—Å—à–µ–º —É—Ä–æ–≤–Ω–µ.",
  "status": "PENDING",
  "created_at": "2023-10-10T12:34:56Z"
}
```

## üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

#### –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
./gradlew test

# –ó–∞–ø—É—Å–∫ —Å –ø—Ä–æ–ø—É—Å–∫–æ–º —Ç–µ—Å—Ç–æ–≤, –ø–æ–º–µ—á–µ–Ω–Ω—ã—Ö –∫–∞–∫ slow
./gradlew test -PexcludeTags="slow"

# –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
./gradlew test -PincludeTags="integration"
```

#### –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–æ–¥—É–ª—è
./gradlew :backend-event-service:test

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞ —Ç–µ—Å—Ç–æ–≤
./gradlew :backend-event-service:test --tests "org.aquastream.event.service.EventServiceTest"

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –º–µ—Ç–æ–¥–∞
./gradlew :backend-event-service:test --tests "org.aquastream.event.service.EventServiceTest.shouldCancelEvent"
```

### –û—Ç–ª–∞–¥–∫–∞ —Ç–µ—Å—Ç–æ–≤

#### –í–∫–ª—é—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
./gradlew test -Dorg.gradle.logging.level=info -Dlogging.level.org.aquastream=DEBUG
```

#### –û—Ç–ª–∞–¥–∫–∞ –≤ IDE

1. –í IntelliJ IDEA –æ—Ç–∫—Ä–æ–π—Ç–µ –∫–ª–∞—Å—Å —Å —Ç–µ—Å—Ç–∞–º–∏
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ç–æ—á–∫–∏ –æ—Å—Ç–∞–Ω–æ–≤–∞ –≤ –Ω—É–∂–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö
3. –ù–∞–∂–º–∏—Ç–µ –ø—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–æ–π –Ω–∞ —Ç–µ—Å—Ç –∏ –≤—ã–±–µ—Ä–∏—Ç–µ "Debug"

#### –û—Ç–ª–∞–¥–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

1. –î–æ–±–∞–≤—å—Ç–µ –≤ —Ç–µ—Å—Ç –º–µ—Ç–æ–¥ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:

```java
@Container
static PostgreSQLContainer<?> postgres = new PostgreSQLContainer<>("postgres:15")
    .withLogConsumer(new Slf4jLogConsumer(LoggerFactory.getLogger("postgres")));

// –í —Ç–µ—Å—Ç–µ –∏–ª–∏ @AfterAll –º–µ—Ç–æ–¥–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–æ–≥–æ–≤
@Test
void checkLogs() {
    System.out.println("Postgres logs: " + postgres.getLogs());
}
```

### CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

–¢–µ—Å—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ CI/CD –ø–∞–π–ø–ª–∞–π–Ω –∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ PR –∏ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º.

#### GitHub Actions –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–æ–≤

```yaml
name: Run Tests

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up JDK 21
      uses: actions/setup-java@v2
      with:
        distribution: 'temurin'
        java-version: '21'
        
    - name: Run tests
      run: ./gradlew test
      
    - name: Generate test report
      if: always()
      run: ./gradlew jacocoTestReport
      
    - name: Upload test report
      if: always()
      uses: actions/upload-artifact@v2
      with:
        name: test-report
        path: build/reports/tests/
        
    - name: Upload coverage report
      if: always()
      uses: actions/upload-artifact@v2
      with:
        name: coverage-report
        path: build/reports/jacoco/test/html/
```

### –ê–Ω–∞–ª–∏–∑ –ø–æ–∫—Ä—ã—Ç–∏—è

–î–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø–æ–∫—Ä—ã—Ç–∏—è —Ç–µ—Å—Ç–∞–º–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Jacoco. –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ç—Ä–µ–±—É–µ–º–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ:

- –°—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞: 80%
- –í–µ—Ç–≤–∏: 70%
- –¶–∏–∫–ª—ã: 60%

#### –ó–∞–ø—É—Å–∫ –æ—Ç—á–µ—Ç–∞ –æ –ø–æ–∫—Ä—ã—Ç–∏–∏

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞ –æ –ø–æ–∫—Ä—ã—Ç–∏–∏
./gradlew jacocoTestReport

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º
./gradlew jacocoTestCoverageVerification
```

#### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Jacoco

```kotlin
// –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ build.gradle.kts
jacoco {
    toolVersion = "0.8.10"
}

tasks.jacocoTestReport {
    reports {
        xml.required.set(true)
        html.required.set(true)
    }
}

tasks.jacocoTestCoverageVerification {
    violationRules {
        rule {
            limit {
                minimum = "0.8".toBigDecimal()
            }
        }
        
        rule {
            element = "CLASS"
            includes = listOf("org.aquastream.event.service.*Service")
            
            limit {
                counter = "LINE"
                value = "COVEREDRATIO"
                minimum = "0.9".toBigDecimal()
            }
            
            limit {
                counter = "BRANCH"
                value = "COVEREDRATIO"
                minimum = "0.8".toBigDecimal()
            }
        }
    }
} 