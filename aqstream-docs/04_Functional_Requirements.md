# Functional Requirements - AqStream

## 1. Аутентификация и авторизация

### 1.1 Регистрация
**FR-AUTH-001**: Система должна позволять регистрацию новых пользователей через email или номер телефона.

**FR-AUTH-002**: При регистрации система должна требовать:
- Email или номер телефона (обязательно)
- Пароль минимум 8 символов (обязательно)
- Имя и фамилия (опционально)

**FR-AUTH-003**: Система должна отправлять подтверждение регистрации через Telegram bot (если указан telegram username).

### 1.2 Вход в систему
**FR-AUTH-004**: Система должна поддерживать вход через email/телефон и пароль.

**FR-AUTH-005**: Система должна использовать JWT токены для сессий:
- Access token: 15 минут
- Refresh token: 7 дней

**FR-AUTH-006**: Система должна поддерживать функцию "Запомнить меня" (refresh token на 30 дней).

### 1.3 Роли и права
**FR-AUTH-007**: Система должна поддерживать 4 роли:
- Гость (незарегистрированный)
- Пользователь (зарегистрированный)
- Организатор
- Администратор

**FR-AUTH-008**: Права доступа по ролям:
- **Гость**: просмотр публичных событий, поиск
- **Пользователь**: + регистрация на события, личный кабинет, уведомления
- **Организатор**: + создание событий, управление регистрациями, аналитика
- **Администратор**: + модерация, управление пользователями, системные настройки

---

## 2. Управление событиями

### 2.1 Создание события
**FR-EVENT-001**: Организатор должен иметь возможность создать событие с полями:
- Название (обязательно, макс. 200 символов)
- Описание (обязательно, rich text)
- Краткое описание (опционально, макс. 500 символов)
- Тип события (выбор из списка)
- Обложка (изображение, опционально)

**FR-EVENT-002**: Настройки времени события:
- Дата и время начала (обязательно)
- Дата и время окончания (обязательно)
- Начало регистрации (опционально, по умолчанию - сразу)
- Окончание регистрации (опционально, по умолчанию - начало события)

**FR-EVENT-003**: Настройки локации:
- Тип: онлайн/офлайн/гибрид
- Для офлайн: адрес и координаты
- Для онлайн: ссылка на трансляцию

**FR-EVENT-004**: Настройки участия:
- Максимальное количество участников (опционально)
- Минимальное количество участников (опционально)
- Требуется подтверждение организатора (да/нет)
- Разрешить лист ожидания (да/нет)

**FR-EVENT-005**: Настройки оплаты:
- Стоимость участия (0 = бесплатно)
- QR-код для оплаты (изображение)
- Инструкции по оплате (текст)

### 2.2 Статусы события
**FR-EVENT-006**: События должны иметь статусы:
- Черновик (не опубликовано)
- На модерации (ожидает проверки)
- Опубликовано (доступно для регистрации)
- Отменено
- Завершено

**FR-EVENT-007**: Переходы между статусами:
- Черновик → На модерации (организатор отправляет)
- На модерации → Опубликовано (админ одобряет)
- На модерации → Черновик (админ отклоняет с комментарием)
- Опубликовано → Отменено (организатор отменяет)
- Опубликовано → Завершено (автоматически по дате окончания)

### 2.3 Модерация событий
**FR-EVENT-008**: Администратор должен видеть очередь событий на модерации.

**FR-EVENT-009**: При модерации админ может:
- Одобрить событие
- Отклонить с указанием причины
- Установить автоодобрение для организатора

**FR-EVENT-010**: При изменении опубликованного события требуется повторная модерация.

### 2.4 Приватность событий
**FR-EVENT-011**: События могут быть:
- Публичными (видны всем)
- Закрытыми (только для сообществ)

**FR-EVENT-012**: Закрытые события видны только участникам указанных сообществ.

---

## 3. Регистрация на события

### 3.1 Запись на событие
**FR-REG-001**: Пользователь может записаться на событие если:
- Он авторизован
- Регистрация открыта
- Есть свободные места или лист ожидания

**FR-REG-002**: При записи пользователь может оставить комментарий (опционально).

**FR-REG-003**: Статусы регистрации:
- Ожидает подтверждения
- Подтверждена
- Отклонена
- Отменена пользователем
- В листе ожидания

### 3.2 Управление регистрациями
**FR-REG-004**: Организатор может:
- Просматривать список всех регистраций
- Подтверждать/отклонять регистрации
- Выполнять массовые действия

**FR-REG-005**: При отклонении регистрации организатор может указать причину.

**FR-REG-006**: Пользователь получает уведомление об изменении статуса регистрации.

### 3.3 Лист ожидания
**FR-REG-007**: Если мест нет, пользователь может встать в лист ожидания.

**FR-REG-008**: При освобождении места:
- Первый в листе ожидания автоматически получает место
- Получает уведомление с таймаутом на подтверждение (24 часа)

**FR-REG-009**: Пользователь видит свою позицию в листе ожидания.

### 3.4 Отмена участия
**FR-REG-010**: Пользователь может отменить свое участие до начала события.

**FR-REG-011**: При отмене освобождается место для листа ожидания.

---

## 4. Система оплаты

### 4.1 Процесс оплаты
**FR-PAY-001**: Для платных событий после регистрации показывается:
- QR-код для оплаты
- Инструкции по оплате
- Форма загрузки подтверждения

**FR-PAY-002**: Пользователь загружает подтверждение оплаты (PDF или изображение).

**FR-PAY-003**: Статусы оплаты:
- Не требуется (бесплатное событие)
- Ожидает оплаты
- Оплачено
- Возврат

### 4.2 Подтверждение оплаты
**FR-PAY-004**: Организатор видит список ожидающих подтверждения оплат.

**FR-PAY-005**: Организатор может:
- Просмотреть загруженное подтверждение
- Подтвердить оплату
- Отклонить с комментарием
- Массово подтвердить

**FR-PAY-006**: После подтверждения оплаты регистрация автоматически подтверждается.

### 4.3 Возврат средств
**FR-PAY-007**: При отмене события организатор получает список для возврата.

**FR-PAY-008**: Организатор может отметить возврат как выполненный.

---

## 5. Группы на событиях

### 5.1 Создание групп
**FR-GROUP-001**: Организатор может создать группы внутри события используя шаблоны:
- Распределение по транспорту
- Распределение по проживанию  
- Распределение по командам

**FR-GROUP-002**: Для каждой группы указывается:
- Название
- Описание
- Минимум/максимум участников

### 5.2 Распределение участников
**FR-GROUP-003**: Участники могут оставить предпочтения по группам в комментарии.

**FR-GROUP-004**: Организатор распределяет участников:
- Вручную перетаскиванием
- С учетом предпочтений

**FR-GROUP-005**: Участники видят свою группу и других участников группы.

---

## 6. Сообщества

### 6.1 Управление сообществами
**FR-COMM-001**: Организатор может создать сообщество с:
- Название
- Описание
- Обложка
- Тип: открытое/закрытое

**FR-COMM-002**: Для закрытых сообществ требуется одобрение заявок.

### 6.2 Членство в сообществах
**FR-COMM-003**: Пользователь может:
- Просматривать открытые сообщества
- Подать заявку на вступление
- Видеть свои сообщества

**FR-COMM-004**: Организатор управляет участниками:
- Одобрение/отклонение заявок
- Исключение участников
- Просмотр списка участников

### 6.3 События сообществ
**FR-COMM-005**: При создании события можно указать сообщества, которым оно доступно.

**FR-COMM-006**: Закрытые события отображаются только участникам сообществ.

---

## 7. Поиск и фильтрация

### 7.1 Поиск событий
**FR-SEARCH-001**: Полнотекстовый поиск по:
- Названию
- Описанию
- Организатору

**FR-SEARCH-002**: Поиск должен поддерживать:
- Морфологию русского языка
- Автодополнение
- Исправление опечаток

### 7.2 Фильтрация
**FR-SEARCH-003**: Фильтры событий:
- Тип события
- Дата (период, ближайшие)
- Локация (радиус от точки)
- Цена (диапазон, бесплатные)
- Организатор
- Сообщество

**FR-SEARCH-004**: Фильтры можно комбинировать.

**FR-SEARCH-005**: Сохранение выбранных фильтров в URL.

### 7.3 Сортировка
**FR-SEARCH-006**: Сортировка событий по:
- Дате (ближайшие/дальние)
- Популярности (количество регистраций)
- Цене (возрастание/убывание)
- Дате публикации (новые/старые)

---

## 8. Уведомления

### 8.1 Типы уведомлений
**FR-NOTIF-001**: Система отправляет уведомления о:
- Подтверждении регистрации
- Отклонении регистрации
- Напоминании о событии (за день)
- Отмене события
- Изменении информации о событии
- Подтверждении оплаты
- Новом месте из листа ожидания

### 8.2 Каналы доставки
**FR-NOTIF-002**: Уведомления доставляются через:
- Личный кабинет (всегда)
- Telegram bot (если подключен)

**FR-NOTIF-003**: Пользователь может настроить типы получаемых уведомлений.

### 8.3 Telegram интеграция
**FR-NOTIF-004**: Подключение Telegram:
- Генерация уникальной ссылки
- Переход в бот
- Автоматическая привязка

**FR-NOTIF-005**: Команды Telegram bot:
- /start - приветствие и привязка
- /events - мои события
- /upcoming - ближайшие события
- /help - справка

---

## 9. Аналитика и отчетность

### 9.1 Дашборд организатора
**FR-ANALYTICS-001**: Ключевые метрики:
- Всего событий
- Всего участников
- Средняя посещаемость
- Конверсия просмотров в регистрации

**FR-ANALYTICS-002**: Графики:
- Динамика регистраций по времени
- Распределение по типам событий
- География участников

### 9.2 Статистика события
**FR-ANALYTICS-003**: Для каждого события:
- Количество просмотров
- Количество регистраций
- Процент подтвержденных
- Процент оплаченных

### 9.3 Экспорт данных
**FR-ANALYTICS-004**: Экспорт списка участников в:
- CSV
- Excel
- PDF

**FR-ANALYTICS-005**: Экспорт включает:
- ФИО
- Email/телефон
- Статус регистрации
- Статус оплаты
- Группа (если есть)

---

## 10. Административная панель

### 10.1 Управление пользователями
**FR-ADMIN-001**: Администратор может:
- Просматривать всех пользователей
- Назначать/отзывать роль организатора
- Блокировать/разблокировать пользователей
- Просматривать историю действий

### 10.2 Управление контентом
**FR-ADMIN-002**: Администратор может:
- Модерировать события
- Удалять неподходящий контент
- Управлять типами событий
- Настраивать шаблоны групп

### 10.3 Системные настройки
**FR-ADMIN-003**: Настройки платформы:
- Лимиты для организаторов
- Таймауты для листа ожидания
- Настройки модерации
- Системные уведомления

### 10.4 Мониторинг
**FR-ADMIN-004**: Системные метрики:
- Количество активных пользователей
- Нагрузка на систему
- Очередь модерации
- Ошибки и инциденты

---

## 11. Нефункциональные требования

### 11.1 Производительность
**NFR-PERF-001**: Время загрузки страницы < 2 секунд.

**NFR-PERF-002**: API response time < 500ms для 95% запросов.

**NFR-PERF-003**: Поддержка 100+ одновременных пользователей.

### 11.2 Надежность
**NFR-REL-001**: Uptime > 99%.

**NFR-REL-002**: RPO (Recovery Point Objective) < 1 час.

**NFR-REL-003**: RTO (Recovery Time Objective) < 4 часа.

### 11.3 Безопасность
**NFR-SEC-001**: Все пароли хэшируются с bcrypt.

**NFR-SEC-002**: HTTPS для всех соединений.

**NFR-SEC-003**: Rate limiting для API.

**NFR-SEC-004**: CORS настройки для фронтенда.

### 11.4 Масштабируемость
**NFR-SCALE-001**: Горизонтальное масштабирование backend.

**NFR-SCALE-002**: CDN для статических ресурсов.

**NFR-SCALE-003**: Кэширование через Redis.

### 11.5 Совместимость
**NFR-COMPAT-001**: Поддержка браузеров:
- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

**NFR-COMPAT-002**: Mobile-first responsive дизайн.

**NFR-COMPAT-003**: Поддержка экранов от 320px.

### 11.6 Доступность
**NFR-ACCESS-001**: WCAG 2.1 Level AA compliance.

**NFR-ACCESS-002**: Поддержка screen readers.

**NFR-ACCESS-003**: Keyboard navigation.
